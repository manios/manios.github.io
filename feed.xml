<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.0">Jekyll</generator><link href="https://manios.org/feed.xml" rel="self" type="application/atom+xml" /><link href="https://manios.org/" rel="alternate" type="text/html" /><updated>2019-08-21T21:26:19+03:00</updated><id>https://manios.org/</id><title type="html">cmanios</title><subtitle>Developer life is a NullPointerException</subtitle><author><name>Christos Manios</name></author><entry><title type="html">Force Maven to execute offline with local repository dependencies in a machine without Internet connection</title><link href="https://manios.org/2019/08/21/force-maven-offline-execute-goal-dependencies" rel="alternate" type="text/html" title="Force Maven to execute offline with local repository dependencies in a machine without Internet connection" /><published>2019-08-21T20:57:53+03:00</published><updated>2019-08-21T20:57:53+03:00</updated><id>https://manios.org/2019/08/21/force-maven-offline-execute-goal-dependencies</id><content type="html" xml:base="https://manios.org/2019/08/21/force-maven-offline-execute-goal-dependencies">&lt;p&gt;Debugging an application which runs on a remote Virtual Machine can prove to be very hard, especially if your client has “exceptional” conditions due to security, company or any other psycological measures/policies. For example, your VM can be a Windows machine (yes, Windows servers are an exception themselves and impose many issues and difficulties), it may have no internet connection or accept no traffic other than http and RDP. Typically we as developers are called to confront such installations and make them work. As a paralellism, we are asked to fix a vehicle engine through the exhaust pipe without having access to the hood!&lt;/p&gt;

&lt;p&gt;If you are not bored to death yet, you may proceed!&lt;/p&gt;

&lt;h2 id=&quot;the-problem&quot;&gt;The problem&lt;/h2&gt;

&lt;p&gt;A few days ago we had to remotely debug a Java Enterprise application inside a VM. The interesting fact was that everything had to be offline. Thus IDE installation, Maven installation and compile a Java project using Maven with no internet connection. Everything had to go fully offline. Really. Trully. Nothing special! (for a non technical person) At first we thought that it would suffice if we just copy the local maven repository from a development machine to the VM. Unfortunately that was not the case and it was not as simple as it looked like.&lt;/p&gt;

&lt;p&gt;After investing 3 hours in searching and numerous trial and error attempts we managed to compile the application using Maven. The steps described are performed in 2 phases:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Preparation steps performed in a development machine with internet connection.&lt;/li&gt;
  &lt;li&gt;Steps performed inside the VM with no internet connection (trully offline).&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;inside-your-development-machine&quot;&gt;Inside your development machine&lt;/h2&gt;

&lt;h3 id=&quot;step-1-create-a-new-local-repository&quot;&gt;Step 1: Create a new local repository&lt;/h3&gt;

&lt;p&gt;This new local repository will be used only for the dependencies required by your application to be compiled in offline mode. It is unnecessary to copy your everyday repository with all other redundant dependencies which maybe numerous and great in size.&lt;/p&gt;

&lt;p&gt;In order to create a new local repository, navigate to your Maven &lt;code class=&quot;highlighter-rouge&quot;&gt;settings.xml&lt;/code&gt; file. By default you can find it in:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\&amp;lt;your-username&amp;gt;\.m2\settings.xml&lt;/code&gt;: in Windows machines&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/home/&amp;lt;your-username&amp;gt;/.m2/settings.xml&lt;/code&gt;: in Linux or *nix machines&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Edit the line:&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Point to a new empty directory --&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;localRepository&amp;gt;&lt;/span&gt;C:/apps/m2repo&lt;span class=&quot;nt&quot;&gt;&amp;lt;/localRepository&amp;gt;&lt;/span&gt;--&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;step-2-run-maven-to-download-dependencies-for-offline-usage&quot;&gt;Step 2: Run Maven to download dependencies for offline usage&lt;/h3&gt;

&lt;p&gt;In order to to download dependencies for offline usage, inside our project we execute the following:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn dependency:go-offline
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Helpful link: &lt;a href=&quot;https://stackoverflow.com/questions/8851424/is-there-a-maven-command-line-option-for-offline-mode&quot;&gt;StackOverflow #8851424&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;step-3-run-your-usual-maven-goals&quot;&gt;Step 3: Run your usual Maven goals&lt;/h3&gt;

&lt;p&gt;You also have to run your usual Maven goals which you eventually you are going to execute again in the offline VM, like &lt;code class=&quot;highlighter-rouge&quot;&gt;clean&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;package&lt;/code&gt;. The reason for that is that Maven did not download the .jars needed for these goals when you run &lt;code class=&quot;highlighter-rouge&quot;&gt;mvn dependency:go-offline&lt;/code&gt;. In our case we run:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn clean &lt;span class=&quot;nb&quot;&gt;test
&lt;/span&gt;mvn clean &lt;span class=&quot;nb&quot;&gt;install
&lt;/span&gt;mvn clean package
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You will notice that Maven downloads some extra .jars needed to execute its goals:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;mvn clean &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] Scanning &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;projects...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] &lt;span class=&quot;nt&quot;&gt;------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] Building jetsprinkler 2.5.0-SNAPSHOT
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] &lt;span class=&quot;nt&quot;&gt;------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; maven-clean-plugin:2.5:clean &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default-clean&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; @ jetsprinkler &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; maven-resources-plugin:2.6:resources &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default-resources&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; @ jetsprinkler &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] Using &lt;span class=&quot;s1&quot;&gt;'UTF-8'&lt;/span&gt; encoding to copy filtered resources.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] Copying 11 resources
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; maven-compiler-plugin:2.3.2:compile &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default-compile&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; @ jetsprinkler &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] Compiling 64 &lt;span class=&quot;nb&quot;&gt;source &lt;/span&gt;files to C:&lt;span class=&quot;se&quot;&gt;\j&lt;/span&gt;avaprojects&lt;span class=&quot;se&quot;&gt;\j&lt;/span&gt;etsprinkler&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;arget&lt;span class=&quot;se&quot;&gt;\c&lt;/span&gt;lasses
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; maven-resources-plugin:2.6:testResources &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default-testResources&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; @ jetsprinkler &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] Using &lt;span class=&quot;s1&quot;&gt;'UTF-8'&lt;/span&gt; encoding to copy filtered resources.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] Copying 8 resources
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; maven-compiler-plugin:2.3.2:testCompile &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default-testCompile&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; @ jetsprinkler &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] Compiling 15 &lt;span class=&quot;nb&quot;&gt;source &lt;/span&gt;files to C:&lt;span class=&quot;se&quot;&gt;\j&lt;/span&gt;avaprojects&lt;span class=&quot;se&quot;&gt;\j&lt;/span&gt;etsprinkler&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;arget&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;est-classes
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; maven-surefire-plugin:2.12.4:test &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default-test&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; @ jetsprinkler &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO] Surefire report directory: C:&lt;span class=&quot;se&quot;&gt;\j&lt;/span&gt;avaprojects&lt;span class=&quot;se&quot;&gt;\j&lt;/span&gt;etsprinkler&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;arget&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;urefire-reports
Downloading from public: https://nexus.manios.org/nexus/repository/public/org/apache/maven/surefire/surefire-junit4/2.12.4/surefire-junit4-2.12.4.pom
Downloaded from public: https://nexus.manios.org/nexus/repository/public/org/apache/maven/surefire/surefire-junit4/2.12.4/surefire-junit4-2.12.4.pom &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2.4 kB at 4.2 kB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Downloading from public: https://nexus.manios.org/nexus/repository/public/org/apache/maven/surefire/surefire-providers/2.12.4/surefire-providers-2.12.4.pom
Downloaded from public: https://nexus.manios.org/nexus/repository/public/org/apache/maven/surefire/surefire-providers/2.12.4/surefire-providers-2.12.4.pom &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2.3 kB at 18 kB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Downloading from public: https://nexus.manios.org/nexus/repository/public/org/apache/maven/surefire/surefire-junit4/2.12.4/surefire-junit4-2.12.4.jar
Downloaded from public: https://nexus.manios.org/nexus/repository/public/org/apache/maven/surefire/surefire-junit4/2.12.4/surefire-junit4-2.12.4.jar &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;37 kB at 187 kB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;-------------------------------------------------------&lt;/span&gt;
 T E S T S
&lt;span class=&quot;nt&quot;&gt;-------------------------------------------------------&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;step-4-copy-your-local-repository-to-the-remote-vm&quot;&gt;Step 4: Copy your local repository to the remote VM&lt;/h3&gt;

&lt;p&gt;We have to copy the contents of our new local repository (in our case &lt;code class=&quot;highlighter-rouge&quot;&gt;C:/apps/m2repo&lt;/code&gt;) to the remote VM with no internet connection. Place the contents of the repository in the respective repository directory.&lt;/p&gt;

&lt;h2 id=&quot;inside-the-offline-machine-with-no-internet-connection&quot;&gt;Inside the offline machine (with no internet connection)&lt;/h2&gt;

&lt;p&gt;The following steps will be run inside the target machine with no internet connection. Verify that you have cloned your source code somewhere.&lt;/p&gt;

&lt;h3 id=&quot;step-5-remove-dependency-files-that-cause-trouble-in-offline-mode&quot;&gt;Step 5: Remove dependency files that cause trouble in offline mode&lt;/h3&gt;

&lt;p&gt;When Maven resolves and downloads a dependency from the internet, it stores 2-3 extra files other than the .jars that contain the library, javadoc or the sources. For example for &lt;a href=&quot;https://mvnrepository.com/artifact/org.springframework/spring-core&quot;&gt;spring-core&lt;/a&gt;, the files inside the local repository are:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; ~/.m2/repository/org/springframework/spring-core/4.1.7.RELEASE/
total 1004
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 bobos bobos     212 Jun 17 13:16 _remote.repositories
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 bobos bobos 1008584 Jun 17 13:16 spring-core-4.1.7.RELEASE.jar
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 bobos bobos      40 Jun 17 13:16 spring-core-4.1.7.RELEASE.jar.sha1
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 bobos bobos    2490 Jun 17 13:16 spring-core-4.1.7.RELEASE.pom
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 bobos bobos      40 Jun 17 13:16 spring-core-4.1.7.RELEASE.pom.sha1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;An here is the peculiar fact:&lt;/p&gt;

&lt;p&gt;Although we configure Maven to work offline, when it detects files with the extension &lt;code class=&quot;highlighter-rouge&quot;&gt;*.repositories&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;*.sha1&lt;/code&gt;, it tries to connect to the internet! Consequently the Maven goal we run tries to download the dependency from the internet and it eventually fails after timeout (StackOverflow &lt;a href=&quot;https://stackoverflow.com/questions/33548395/how-do-i-force-maven-to-use-my-local-repository-rather-than-going-out-to-remote&quot;&gt;#33548395&lt;/a&gt;). To resolve this issue we have to recursively delete all files with the aforementioned suffixes. Hence, execute:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# cd to repository directory&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/.m2/repository

&lt;span class=&quot;c&quot;&gt;# Then delete recursively all files&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# with the extension `*.repositories` or `*.sha1`&lt;/span&gt;
find &lt;span class=&quot;nt&quot;&gt;-iname&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;*.repositories&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-exec&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
find &lt;span class=&quot;nt&quot;&gt;-iname&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;*.sha1&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-exec&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This issue might also be resolved by tweaking the &lt;a href=&quot;https://maven.apache.org/ref/3.3.3/maven-settings/settings.html#class_snapshots&quot;&gt;updatePolicy&lt;/a&gt; in Maven as mentioned in StackOverflow &lt;a href=&quot;https://stackoverflow.com/questions/33548395/how-do-i-force-maven-to-use-my-local-repository-rather-than-going-out-to-remote&quot;&gt;#33548395&lt;/a&gt; but unfortunately we did not have the time to test it.&lt;/p&gt;

&lt;h3 id=&quot;step-6-optional-fix-parent-pom-references&quot;&gt;Step 6 (optional): Fix parent pom references&lt;/h3&gt;

&lt;p&gt;In our case, the project had a parent pom:&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;parent&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.airplaneman&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;super-pom&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.1.4&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/parent&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which could not be downloaded from an external Maven repository. We had the files offline, however this configuration could not work. To make it work we had to add the &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;relativePath&amp;gt;&lt;/code&gt; to the pom file. This is trully a relative path to the project.&lt;/p&gt;

&lt;p&gt;Hence our project was placed in:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;C:/projects/jetsprinkler&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;and the parent pom was located in&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;C:/Users/cmanios/.m2/repository/com/airplanman/super-pom/1.1.4/super-pom-1.1.4.pom&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To reference the parent pom in a relative way, we resulted in the following configuration:&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;parent&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.airplaneman&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;super-pom&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.1.4&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;relativePath&amp;gt;&lt;/span&gt;../../Users/cmanios/.m2/repository/com/airplanman/super-pom/1.1.4/super-pom-1.1.4.pom&lt;span class=&quot;nt&quot;&gt;&amp;lt;/relativePath&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/parent&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For more info regarding parent pom refer to:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;DZone: &lt;a href=&quot;https://dzone.com/articles/mavens-non-resolvable-parent&quot;&gt;Maven Non Resolvable parent pom&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;StackOverflow &lt;a href=&quot;https://stackoverflow.com/questions/7612309/maven-non-resolvable-parent-pom&quot;&gt;#7612309 Non Resolvable parent pom&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.google.com/search?client=firefox-b-d&amp;amp;q=offline+non+resolvable+parent+pom&quot;&gt;Google search: Offline Non Resolvable parent pom&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;step-7-configure-maven-to-work-offline&quot;&gt;Step 7: Configure Maven to work offline&lt;/h3&gt;

&lt;p&gt;Edit your Maven &lt;code class=&quot;highlighter-rouge&quot;&gt;settings.xml&lt;/code&gt; file in the following lines:&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- (Optional) Set the path to your local repository --&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;localRepository&amp;gt;&lt;/span&gt;/path/to/local/repo&lt;span class=&quot;nt&quot;&gt;&amp;lt;/localRepository&amp;gt;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Run Maven in Offline mode --&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;offline&amp;gt;&lt;/span&gt;true&lt;span class=&quot;nt&quot;&gt;&amp;lt;/offline&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;step-8-execute-your-goals-with--o-and--nsu-flag&quot;&gt;Step 8: Execute your goals with -o and -nsu flag&lt;/h3&gt;

&lt;p&gt;It is useful that you run your goals with &lt;code class=&quot;highlighter-rouge&quot;&gt;-o&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;-nsu&lt;/code&gt; flags. According to &lt;a href=&quot;https://maven.apache.org/ref/3.1.0/maven-embedder/cli.html&quot;&gt;documentation&lt;/a&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-o&lt;/code&gt;: Work offline&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt; -nsu,--no-snapshot-updates&lt;/code&gt;: Suppress SNAPSHOT updates&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Thus your goal will look like this:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mvn &lt;span class=&quot;nt&quot;&gt;-nsu&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; clean &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;troubleshooting&quot;&gt;Troubleshooting&lt;/h2&gt;

&lt;h3 id=&quot;cannot-access-central-httpsrepomavenapacheorgmaven2-in-offline-mode-and-the-artifact-orgapachemavenplugins&quot;&gt;Cannot access central (https://repo.maven.apache.org/maven2) in offline mode and the artifact org.apache.maven.plugins…&lt;/h3&gt;

&lt;p&gt;You may step on this error:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[WARNING] The POM for org.apache.maven.plugins:maven-resources-plugin:jar:2.6 is missing, no dependency information available
[INFO] ---------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------
[ERROR] Plugin org.apache.maven.plugins:maven-resources-plugin:2.6 or one of its dependencies could not be resolved: Cannot access central (https://repo.maven.apache.org/maven2) in offline mode and the artifact org.apache.maven.plugins:maven-resources-plugin:jar:2.6 has not been downloaded from it before. -&amp;gt; [Help 1]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;if you omit &lt;strong&gt;Step 3&lt;/strong&gt;. Maven tries to download it’s plugins to run the goals but they do not exist.&lt;/p&gt;

&lt;h3 id=&quot;non-resolvable-parent-pom--and-parentrelativepath-points-at-no-local-pom&quot;&gt;Non-resolvable parent POM […] and ‘parent.relativePath’ points at no local POM&lt;/h3&gt;

&lt;p&gt;If you see an error similar to the following:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-log&quot;&gt;[INFO] Scanning for projects...
[DEBUG] Verifying availability of C:\Users\admin_manios\.m2\repository\com\airplanman\super-pom\1.1.4\super-pom-1.1.4.pom from [central (https://repo.maven.apache.org/maven2, default, releases)]
[ERROR] [ERROR] Some problems were encountered while processing the POMs:
[FATAL] Non-resolvable parent POM for airplanman.airsprinkler:jetengine:2.5.0-SNAPSHOT: Cannot access central (https://repo.maven.apache.org/maven2) in offline mode and the artifact com.airplaneman:super-pom:pom:1.1.4 has not been downloaded from it before. and 'parent.relativePath' points at no local POM @ line 10, column 10
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;then it means that either you did not copy the parent pom in your local repository for offline usage, or you did not set correctly the &lt;code class=&quot;highlighter-rouge&quot;&gt;relativePath&lt;/code&gt;. Please refer to &lt;strong&gt;Step 6&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;maven-attempts-to-download-artifacts-although-we-have-configure-it-for-offline-mode&quot;&gt;Maven attempts to download artifacts although we have configure it for offline mode&lt;/h3&gt;

&lt;p&gt;Either you have not downloaded all your dependencies as described in &lt;strong&gt;Step 2&lt;/strong&gt; or you have not deleted the files described in &lt;strong&gt;Step 5.&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;I hope this article helps you and you will not waste so much time to do the same. Have a nice day and a wonderful and fruitful life!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="maven" /><category term="offline" /><category term="goal" /><category term="dependencies" /><category term="without" /><category term="internet" /><category term="connection" /><category term="parent" /><category term="pom" /><category term="non" /><category term="resolvable" /><summary type="html">Debugging an application which runs on a remote Virtual Machine can prove to be very hard, especially if your client has “exceptional” conditions due to security, company or any other psycological measures/policies. For example, your VM can be a Windows machine (yes, Windows servers are an exception themselves and impose many issues and difficulties), it may have no internet connection or accept no traffic other than http and RDP. Typically we as developers are called to confront such installations and make them work. As a paralellism, we are asked to fix a vehicle engine through the exhaust pipe without having access to the hood!</summary></entry><entry><title type="html">MongoDB query to aggregate documents by a specific property</title><link href="https://manios.org/2019/08/11/mongodb-aggregate-documents-by-property" rel="alternate" type="text/html" title="MongoDB query to aggregate documents by a specific property" /><published>2019-08-11T10:41:00+03:00</published><updated>2019-08-11T10:41:00+03:00</updated><id>https://manios.org/2019/08/11/mongodb-aggregate-documents-by-property</id><content type="html" xml:base="https://manios.org/2019/08/11/mongodb-aggregate-documents-by-property">&lt;p&gt;Yesterday a colleague had a problem on finding a query. His documents looked like the following:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;aaa&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;answers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;gender&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;male&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;bbb&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;answers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;gender&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;female&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;category&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;aaa&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;answers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;gender&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;male&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;He needed to query them and get an output similar to the following (format did not matter):&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;category&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;aaa&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;male&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;category&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;aaa&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;female&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;category&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;bbb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;female&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;category&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;bbb&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;male&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;His requirments was to fetch the data using only one query using MongoDB aggregation. So after some thought I concluded to the following query:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getCollection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'question1034'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;aggregate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;$unwind&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;$answers&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;$group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;na&quot;&gt;_id&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;gender&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;$answers.gender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;category&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;$category&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
       &lt;span class=&quot;na&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;$sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}}&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;$project&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;na&quot;&gt;_id&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
       &lt;span class=&quot;s2&quot;&gt;&quot;gender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;$_id.gender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
       &lt;span class=&quot;s2&quot;&gt;&quot;category&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;$_id.category&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
       &lt;span class=&quot;na&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The query returns this result:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;count&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;gender&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;female&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;category&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;bbb&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;count&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;gender&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;male&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;category&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;aaa&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I hope this helped you if you stumble upon an issue like this. Greetings from sunny and hot Greece (inside an airconditioned environment)!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="mongodb" /><category term="nosql" /><category term="database" /><category term="query" /><category term="aggregation" /><category term="framework" /><summary type="html">Yesterday a colleague had a problem on finding a query. His documents looked like the following: { id : 1, category : &quot;aaa&quot;, answers : [ { gender : &quot;male&quot;} ] } { id : 2, category : &quot;bbb&quot; , answers : [ { gender : &quot;female&quot;} ] }, { id : 3, category : &quot;aaa&quot;, answers : [ { gender : &quot;male&quot;} ] } He needed to query them and get an output similar to the following (format did not matter): { &quot;category&quot; : &quot;aaa&quot;, &quot;male&quot; : 2 }, { &quot;category&quot; : &quot;aaa&quot;, &quot;female&quot; : 0 }, { &quot;category&quot; : &quot;bbb&quot;, &quot;female&quot; : 1 }, { &quot;category&quot; : &quot;bbb&quot;, &quot;male&quot; : 0 } His requirments was to fetch the data using only one query using MongoDB aggregation. So after some thought I concluded to the following query: db.getCollection('question1034') .aggregate([ { $unwind : &quot;$answers&quot; }, { $group: { _id : {&quot;gender&quot; : &quot;$answers.gender&quot;, &quot;category&quot; : &quot;$category&quot;}, count: { $sum: 1 }} }, { $project: { _id :0 , &quot;gender&quot;: &quot;$_id.gender&quot;, &quot;category&quot;: &quot;$_id.category&quot;, count: 1 }} ]) The query returns this result: { &quot;count&quot; : 1.0, &quot;gender&quot; : &quot;female&quot;, &quot;category&quot; : &quot;bbb&quot; }, { &quot;count&quot; : 2.0, &quot;gender&quot; : &quot;male&quot;, &quot;category&quot; : &quot;aaa&quot; } I hope this helped you if you stumble upon an issue like this. Greetings from sunny and hot Greece (inside an airconditioned environment)!</summary></entry><entry><title type="html">Solved: HP 630 notebook overheating problem</title><link href="https://manios.org/2018/10/07/hp-630-notebook-overheating-problem" rel="alternate" type="text/html" title="Solved: HP 630 notebook overheating problem" /><published>2018-10-07T21:54:00+03:00</published><updated>2018-10-07T21:54:00+03:00</updated><id>https://manios.org/2018/10/07/hp-630-notebook-overheating-problem</id><content type="html" xml:base="https://manios.org/2018/10/07/hp-630-notebook-overheating-problem">&lt;h2 id=&quot;first-incident&quot;&gt;First Incident&lt;/h2&gt;

&lt;p&gt;A year ago (April 2017) while we were using a &lt;a href=&quot;https://support.hp.com/in-en/drivers/selfservice/hp-630-notebook-pc/5086782&quot;&gt;HP 630&lt;/a&gt; notebook in a training, it started overheating and eventually made an emergency shutdown. The fan was spinning at maximum speed and the problem was not solved by restarting it. Temperatures could rise high up to 75 degrees Celcious when browsing pages, not to mention when running VMs for our training! At the same time a friend of ours, who owns the same notebook, informed us that due to the overheating, its WiFi module got burnt.&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/temperature2018-08-3013-36-25.png&quot;&gt;&lt;img src=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/temperature2018-08-3013-36-25.png&quot; alt=&quot;HP 630 Overheating problem. Screenshot of CPU temperatures in Linux Mint 18.1 while browsing&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;HP 630 Overheating problem. Screenshot of CPU temperatures in Linux Mint 18.1 while browsing.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&quot;the-problem&quot;&gt;The problem&lt;/h2&gt;

&lt;p&gt;After &lt;a href=&quot;https://www.google.com/search?q=hp+630+overheat&amp;amp;ie=utf-8&amp;amp;oe=utf-8&amp;amp;client=firefox-b&quot;&gt;searching in the internet&lt;/a&gt;, we found out that the issue can be caused by dust inside the CPU fan which blocks the air ventilation grilles. Thus, CPU is suffocating.&lt;/p&gt;

&lt;p&gt;The solution proposed was to disassemble the notebook and clean the CPU fan. Be advised that the notebook worked for 4 years, overheating, but neglected because it had not reached the issue of abrupt shutdown.&lt;/p&gt;

&lt;h2 id=&quot;remedy&quot;&gt;Remedy&lt;/h2&gt;

&lt;p&gt;We wanted to clean the notebook ourselves, so we followed the official HP 630 &lt;a href=&quot;http://h22235.www2.hp.com/hpinfo/globalcitizenship/environment/productdata/Countries/_MultiCountry/disassembly_notebo_2011418191247.pdf&quot;&gt;Product End-of-Life Disassembly Instructions&lt;/a&gt; (&lt;a href=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/disassembly_notebo_2011418191247.pdf&quot;&gt;alternative link&lt;/a&gt;) combined with visual assistance from a Youtube &lt;a href=&quot;https://www.youtube.com/watch?v=GE_hqrxzX4E&quot;&gt;video&lt;/a&gt; and we removed the CPU fan in order to clean it. After dissasembling the CPU fan we found out that all ventilation grilles were blocked by a “sponge” of dust formed in front of them. Under no circumstances air could could cool down the CPU!&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/IMG_20170403_233924.png&quot;&gt;&lt;img src=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/IMG_20170403_233924.png&quot; alt=&quot;HP 630 dust forms a sponge which blocks all ventilation grilles of CPU Fan.&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;HP 630 dust forms a sponge which blocks all ventilation grilles of CPU Fan.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure&gt;
    &lt;a href=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/IMG_20170403_234022.png&quot;&gt;&lt;img src=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/IMG_20170403_234022.png&quot; alt=&quot;Focus on the thickness of the dust sponge which blocks all ventilation grilles of CPU Fan.&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;Focus on the thickness of the dust sponge which blocks all ventilation grilles of CPU Fan.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;After cleaning the CPU fan from the dust, the temperatures went back to normal as seen in the screenshot:&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/temperature2018-10-0617-25-28.png&quot;&gt;&lt;img src=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/temperature2018-10-0617-25-28.png&quot; alt=&quot;HP 630 Overheating problem. Screenshot of CPU temperatures in Linux Mint 18.1 while browsing&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;HP 630 temperatures back to normal after cleaning CPU fan. Screenshot in Linux Mint 18.1 while browsing.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&quot;annual-service&quot;&gt;Annual Service&lt;/h2&gt;

&lt;p&gt;Yesterday we cleaned it again after 17 months as the notebook was overheating. We discovered that the dust had formed again a sponge&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/IMG_20181006_160202.png&quot;&gt;&lt;img src=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/IMG_20181006_160202.png&quot; alt=&quot;HP 630 dust sponge a year after the first cleaning. It still blocks all ventilation grilles of CPU Fan.&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;HP 630 dust sponge a year after the first cleaning. It still blocks all ventilation grilles of CPU Fan.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;, lesser in thickness than the previous time.&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/IMG_20181006_160229.png&quot;&gt;&lt;img src=&quot;/images/2018-10-07-hp-630-overheat-problem-clean/IMG_20181006_160229.png&quot; alt=&quot;HP 630 dust sponge thickness a year after the first cleaning.&quot; /&gt;&lt;/a&gt;
    &lt;figcaption&gt;HP 630 dust sponge thickness a year after the first cleaning.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Consequently we will monitor the temperature of our notebook and when it starts dangerously increasing, we will have to clean it again! We hope it does happen once in a year as the disassembly, cleaning and reassembly costs us two hours of work!&lt;/p&gt;

&lt;p&gt;Cheers!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="hp" /><category term="630" /><category term="hp630" /><category term="hp-630" /><category term="overheat" /><category term="overheating" /><category term="problem" /><category term="shutdown" /><category term="clean" /><category term="fan" /><summary type="html">First Incident</summary></entry><entry><title type="html">Resolve “Could not find __debug_frame section in binary” when trying to Debug Metricbeat with Delve and Go 1.10.4</title><link href="https://manios.org/2018/10/05/metricbeat-debug-frame-section-error" rel="alternate" type="text/html" title="Resolve &quot;Could not find __debug_frame section in binary&quot; when trying to Debug Metricbeat with Delve and Go 1.10.4" /><published>2018-10-05T22:35:00+03:00</published><updated>2018-10-05T22:35:00+03:00</updated><id>https://manios.org/2018/10/05/metricbeat-debug-frame-section-error</id><content type="html" xml:base="https://manios.org/2018/10/05/metricbeat-debug-frame-section-error">&lt;p&gt;Today we were trying to debug &lt;a href=&quot;https://www.elastic.co/products/beats/metricbeat&quot;&gt;Metricbeat&lt;/a&gt; (on commit &lt;a href=&quot;https://github.com/elastic/beats/commit/cff3e40cfedb9521d7249caaa569668de203dc59&quot;&gt;#cff3e40c&lt;/a&gt;) using &lt;a href=&quot;http://code.visualstudio.com/&quot;&gt;Visual Studio Code&lt;/a&gt; v1.27.2 and &lt;a href=&quot;https://github.com/derekparker/delve&quot;&gt;Delve&lt;/a&gt; debugger but it failed with the error:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Could not find __debug_frame section in binary
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Our environment was:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;go version
go version go1.10.4 linux/amd64
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;dlv version
Delve Debugger
Version: 1.1.0
Build: &lt;span class=&quot;nv&quot;&gt;$Id&lt;/span&gt;: 1990ba12450cab9425a2ae62e6ab988725023d5c
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Our Visual Studio Code debug configuration was the following:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;0.2.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;configurations&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Launch&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;go&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;request&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;launch&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;remotePath&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2345&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;program&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;${fileDirname}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;env&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-e&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-d&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;'*'&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;metricbeat.yml&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;showLog&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After 1 hour of searching in the internet we found that starting from &lt;code class=&quot;highlighter-rouge&quot;&gt;go 1.10.x&lt;/code&gt; the &lt;code class=&quot;highlighter-rouge&quot;&gt;.debug_frame&lt;/code&gt; is &lt;u&gt;missing entirely&lt;/u&gt;, so Delve could not be used.&lt;/p&gt;

&lt;h2 id=&quot;solution&quot;&gt;Solution&lt;/h2&gt;

&lt;p&gt;In order to make debugging with Delve work again we downgraded to &lt;code class=&quot;highlighter-rouge&quot;&gt;go 1.9.7&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;You can find more information regarding the problem in the following links:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Elastic Discuss question &lt;a href=&quot;https://discuss.elastic.co/t/debug-filebeat/146817&quot;&gt;#146817&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/golang/go/issues/23733&quot;&gt;olang/go #23733&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/derekparker/delve/issues/860&quot;&gt;derekparker/delve #860&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/orbs-network/orbs-network-go/issues/245&quot;&gt;orbs-network/orbs-network-go #245&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Have a nice night!&lt;/p&gt;

&lt;p&gt;P.S. TAKIS R.I.P. ! We will never forget! We had eaten the best gyros in Triandria, Thessaloniki!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="elastic" /><category term="metricbeat" /><category term="beats" /><category term="elasticsearch" /><category term="debug" /><category term="frame" /><category term="go" /><category term="golang" /><category term="elk" /><category term="error" /><category term="delve" /><category term="kibana" /><category term="index" /><category term="monitor" /><summary type="html">Today we were trying to debug Metricbeat (on commit #cff3e40c) using Visual Studio Code v1.27.2 and Delve debugger but it failed with the error: Could not find __debug_frame section in binary Our environment was: $ go version go version go1.10.4 linux/amd64 $ dlv version Delve Debugger Version: 1.1.0 Build: $Id: 1990ba12450cab9425a2ae62e6ab988725023d5c Our Visual Studio Code debug configuration was the following: { &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [ { &quot;name&quot;: &quot;Launch&quot;, &quot;type&quot;: &quot;go&quot;, &quot;request&quot;: &quot;launch&quot;, &quot;remotePath&quot;: &quot;&quot;, &quot;port&quot;: 2345, &quot;host&quot;: &quot;127.0.0.1&quot;, &quot;program&quot;: &quot;${fileDirname}&quot;, &quot;env&quot;: {}, &quot;args&quot;: [&quot;-e&quot;,&quot;-d&quot;,&quot;'*'&quot;,&quot;-c&quot;, &quot;metricbeat.yml&quot;], &quot;showLog&quot;: true } ] } After 1 hour of searching in the internet we found that starting from go 1.10.x the .debug_frame is missing entirely, so Delve could not be used. Solution In order to make debugging with Delve work again we downgraded to go 1.9.7. You can find more information regarding the problem in the following links: Elastic Discuss question #146817 olang/go #23733 derekparker/delve #860 orbs-network/orbs-network-go #245 Have a nice night! P.S. TAKIS R.I.P. ! We will never forget! We had eaten the best gyros in Triandria, Thessaloniki!</summary></entry><entry><title type="html">Rsyslog - Parse Json and enrich IP with Geolocation using Maxmind GeoLite2 City and ISP</title><link href="https://manios.org/2018/08/18/logstash-geoip-json-logs-maxmint-geolite-docker" rel="alternate" type="text/html" title="Rsyslog - Parse Json and enrich IP with Geolocation using Maxmind GeoLite2 City and ISP" /><published>2018-08-18T10:13:44+03:00</published><updated>2018-08-18T10:13:44+03:00</updated><id>https://manios.org/2018/08/18/logstash-geoip-json-logs-maxmint-geolite-docker</id><content type="html" xml:base="https://manios.org/2018/08/18/logstash-geoip-json-logs-maxmint-geolite-docker">&lt;p&gt;Today we wanted to parse some json logs which we had in a file using &lt;a href=&quot;http://rsyslog.com/&quot;&gt;Rsyslog&lt;/a&gt; and enrich  them with Geolocation information regarding the city and the ISP an IP belongs. We initially tried with Logstash (see relevant &lt;a href=&quot;/2018/08/14/logstash-geoip-json-logs-maxmint-geolite-docker&quot;&gt;previous blog post&lt;/a&gt;) but it was too slow. Thus we decided to try with parsing with Rsyslog. The file, let’s call it &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/log/input-geo.json&lt;/code&gt; had the following structure and content. (It is the same as in Logstash post):&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Christos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;63.145.248.101&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Nikos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;98.158.156.175&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Rsyslog has &lt;a href=&quot;https://www.rsyslog.com/doc/v8-stable/configuration/modules/mmdblookup.html&quot;&gt;MaxMind/GeoIP DB lookup (mmdblookup)&lt;/a&gt; module which adds information about the geographical location of IP addresses, based on data from the Maxmind GeoLite2 databases. In our case we used:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://dev.maxmind.com/geoip/geoip2/geolite2/&quot;&gt;GeoLite2 City&lt;/a&gt; database (free)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.maxmind.com/en/geoip2-isp-database&quot;&gt;GeoIP2 ISP &lt;/a&gt; Database (commercial licence)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We wanted to parse the JSON file enrich the &lt;code class=&quot;highlighter-rouge&quot;&gt;src_ip&lt;/code&gt; field and store the geolocation information to &lt;code class=&quot;highlighter-rouge&quot;&gt;src_geoip&lt;/code&gt;. Then we forward the message to Elasticsearch using &lt;a href=&quot;https://www.rsyslog.com/doc/v8-stable/configuration/modules/omelasticsearch.html&quot;&gt;omelasticsearch: Elasticsearch Output Module&lt;/a&gt;. For debugging purposes we also enabled &lt;a href=&quot;https://www.elastic.co/guide/en/logstash/current/plugins-outputs-file.html&quot;&gt;file output&lt;/a&gt;. Thus , the configuration (&lt;code class=&quot;highlighter-rouge&quot;&gt;rsyslog.conf&lt;/code&gt;) looked like the following:&lt;/p&gt;

&lt;div class=&quot;language-conf highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#  /etc/rsyslog.conf	Configuration file for rsyslog.
#
#			For more information see
#			/usr/share/doc/rsyslog-doc/html/rsyslog_conf.html
#
#  Default logging rules can be found in /etc/rsyslog.d/50-default.conf
&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#################
#### MODULES ####
#################
&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imuxsock&quot;&lt;/span&gt;) &lt;span class=&quot;c&quot;&gt;# provides support for local system logging
# module(load=&quot;imklog&quot;)   # provides kernel logging support
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;immark&quot;&lt;/span&gt;)  &lt;span class=&quot;c&quot;&gt;# provides --MARK-- message capability
# $ModLoad imuxsock # provides support for local system logging
# $ModLoad imklog   # provides kernel logging support (previously done by rklogd)
#$ModLoad immark  # provides --MARK-- message capability
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# provides UDP syslog reception
# $ModLoad imudp
# $UDPServerRun 514
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# provides TCP syslog reception
# $ModLoad imtcp
# $InputTCPServerRun 514
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;builtin:omfile&quot;&lt;/span&gt;)
&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;mmnormalize&quot;&lt;/span&gt;) &lt;span class=&quot;c&quot;&gt;# parser using liblognorm
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;mmjsonparse&quot;&lt;/span&gt;) &lt;span class=&quot;c&quot;&gt;#for parsing CEE-enhanced syslog messages
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imfile&quot;&lt;/span&gt;)
&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;mmdblookup&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;container&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;!src_geo&quot;&lt;/span&gt;)

&lt;span class=&quot;c&quot;&gt;###########################
#### GLOBAL DIRECTIVES ####
###########################
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#
# Use traditional timestamp format.
# To enable high precision timestamps, comment out the following line.
#
&lt;/span&gt;$&lt;span class=&quot;n&quot;&gt;ActionFileDefaultTemplate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RSYSLOG_TraditionalFileFormat&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Filter duplicated messages
&lt;/span&gt;$&lt;span class=&quot;n&quot;&gt;RepeatedMsgReduction&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#
# Set the default permissions for all log files.
#
&lt;/span&gt;$&lt;span class=&quot;n&quot;&gt;FileOwner&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;
$&lt;span class=&quot;n&quot;&gt;FileGroup&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;
$&lt;span class=&quot;n&quot;&gt;FileCreateMode&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0640&lt;/span&gt;
$&lt;span class=&quot;n&quot;&gt;DirCreateMode&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0755&lt;/span&gt;
$&lt;span class=&quot;n&quot;&gt;Umask&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0022&lt;/span&gt;
$&lt;span class=&quot;n&quot;&gt;PrivDropToUser&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;syslog&lt;/span&gt;
$&lt;span class=&quot;n&quot;&gt;PrivDropToGroup&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;syslog&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# General globals
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;global&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;net&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;enableDNS&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;off&quot;&lt;/span&gt;)

&lt;span class=&quot;c&quot;&gt;# Remove Control Chars
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;global&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;parser&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;escapeControlCharactersOnReceive&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;off&quot;&lt;/span&gt; )

&lt;span class=&quot;c&quot;&gt;#
# Where to place spool files
#
&lt;/span&gt;$&lt;span class=&quot;n&quot;&gt;WorkDirectory&lt;/span&gt; /&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;spool&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;rsyslog&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;global&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;workDirectory&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/var/spool/rsyslog&quot;&lt;/span&gt;)
&lt;span class=&quot;c&quot;&gt;#
# Include all config files in /etc/rsyslog.d/
#
# $IncludeConfig /etc/rsyslog.d/*.conf
&lt;/span&gt;


&lt;span class=&quot;c&quot;&gt;#################
#### Inputs  ####
#################
&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# provides UDP syslog reception
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imudp&quot;&lt;/span&gt;)
&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imudp&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;514&quot;&lt;/span&gt;)

&lt;span class=&quot;c&quot;&gt;# provides TCP syslog reception
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imtcp&quot;&lt;/span&gt;)
&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imtcp&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;514&quot;&lt;/span&gt; )

&lt;span class=&quot;c&quot;&gt;# File 1
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imfile&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/opt/input-geo.json&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;Tag&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;geoip&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;PersistStateInterval&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;freshStartTail&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;off&quot;&lt;/span&gt;)

&lt;span class=&quot;c&quot;&gt;#################
### Templates ###
#################
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# this is for formatting our syslog in JSON with @timestamp for Json messages
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;geoip&quot;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;list&quot;&lt;/span&gt;) {
    &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;{&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;@&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;\&lt;span class=&quot;s2&quot;&gt;&quot;:\&quot;&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;@timestamp\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)		&lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;timegenerated&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dateFormat&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;rfc3339&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;host\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)			    &lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;hostname&quot;&lt;/span&gt;) 
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;type\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;syslog&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;syslog_timestamp\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)	&lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;timereported&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dateFormat&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;rfc3164&quot;&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;syslog_hostname\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)	&lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;hostname&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;syslog_program\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)	&lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;programname&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;syslog_message\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)	&lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;msg&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;received_at\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)		&lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;timegenerated&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dateFormat&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;rfc3339&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;received_from\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)	    &lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;fromhost&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;path\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)      	    &lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;$!metadata!filename&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;name\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)              &lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;$!name&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;src_ip\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)            &lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;$!src_ip&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;src_geoip\&quot;&lt;/span&gt;:{&lt;span class=&quot;s2&quot;&gt;&quot;)          property(name=&quot;&lt;/span&gt;$!&lt;span class=&quot;n&quot;&gt;src_geo&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; position.from=&quot;&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;}\n&quot;&lt;/span&gt;)
}


&lt;span class=&quot;c&quot;&gt;#################
#### Actions ####
#################
&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;###Fix text to utf8, disabled for now
###action(type=&quot;mmutf8fix&quot;)
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#action(type=&quot;omfile&quot; file=&quot;/tmp/logtesting&quot; template=&quot;RSYSLOG_DebugFormat&quot;)
&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;if&lt;/span&gt; ($&lt;span class=&quot;n&quot;&gt;syslogtag&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contains&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'geoip'&lt;/span&gt;) &lt;span class=&quot;n&quot;&gt;then&lt;/span&gt; {
    
    
    &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;mmjsonparse&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cookie&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)
    
    &lt;span class=&quot;n&quot;&gt;if&lt;/span&gt; $&lt;span class=&quot;n&quot;&gt;parsesuccess&lt;/span&gt; == &lt;span class=&quot;s2&quot;&gt;&quot;OK&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;then&lt;/span&gt; {

        &lt;span class=&quot;c&quot;&gt;# https://github.com/rsyslog/rsyslog/issues/1650
&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;# Add MaxMind/GeoIP DB lookup information
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;( &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;mmdblookup&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mmdbfile&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/etc/rsyslog.d/GeoLite2-City.mmdb&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;!src_ip&quot;&lt;/span&gt; 
                &lt;span class=&quot;n&quot;&gt;fields&lt;/span&gt;=[&lt;span class=&quot;s2&quot;&gt;&quot;:timezone:!location!time_zone&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:latitude:!location!latitude&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:longitude:!location!longitude&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:dma_code:!location!metro_code&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:city_name:!names!en&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:continent_code:!continent!code&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:country_code2:!country!iso_code&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:country_code3:!country!iso_code&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:country_name:!country!names!en&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:postal_code:!postal!code&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:region_code:!subdivisions!iso_code&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:region_name:!subdivisions!names!en&quot;&lt;/span&gt;
                        ]
        )

        &lt;span class=&quot;c&quot;&gt;# Add MaxMind/GeoIP ISP DB lookup information
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;( &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;mmdblookup&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mmdbfile&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/etc/rsyslog.d/GeoIP2-ISP.mmdb&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;!src_ip&quot;&lt;/span&gt; 
                &lt;span class=&quot;n&quot;&gt;fields&lt;/span&gt;=[&lt;span class=&quot;s2&quot;&gt;&quot;:asn:!autonomous_system_number&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:as_org:!autonomous_system_organization&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;!isp&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;!organization&quot;&lt;/span&gt;
                        ]
        )
        
        &lt;span class=&quot;c&quot;&gt;# Add IP to src_geo object
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;set&lt;/span&gt; $!&lt;span class=&quot;n&quot;&gt;src_geo&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;ip&lt;/span&gt; = $!&lt;span class=&quot;n&quot;&gt;src_ip&lt;/span&gt;;

        &lt;span class=&quot;c&quot;&gt;# If geolocation was successful, add lat,lon in a special location object
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;if&lt;/span&gt; $! &lt;span class=&quot;n&quot;&gt;contains&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'latitude'&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;then&lt;/span&gt; {
            &lt;span class=&quot;n&quot;&gt;set&lt;/span&gt; $!&lt;span class=&quot;n&quot;&gt;src_geo&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt; = $!&lt;span class=&quot;n&quot;&gt;src_geo&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;latitude&lt;/span&gt;;
            &lt;span class=&quot;n&quot;&gt;set&lt;/span&gt; $!&lt;span class=&quot;n&quot;&gt;src_geo&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;lon&lt;/span&gt; = $!&lt;span class=&quot;n&quot;&gt;src_geo&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;longitude&lt;/span&gt;;
        }

        &lt;span class=&quot;c&quot;&gt;# Output to a new file
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;omfile&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/tmp/json-output&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;geoip&quot;&lt;/span&gt;)

        &lt;span class=&quot;c&quot;&gt;# Output to Elasticsearch
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;omelasticsearch&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;192.168.1.10&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;serverport&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;9200&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;geoip&quot;&lt;/span&gt;  
            &lt;span class=&quot;n&quot;&gt;searchIndex&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;geoindex&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;dynSearchIndex&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;on&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;searchType&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;syslog&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;bulkmode&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;on&quot;&lt;/span&gt;                   &lt;span class=&quot;c&quot;&gt;# use the Bulk API
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;dequeuebatchsize&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;5000&quot;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# ES bulk size
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;100000&quot;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# capacity of the action queue
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;workerthreads&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;5&quot;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# 5 workers for the action
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;resumeretrycount&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;-1&quot;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# retry indefinitely if ES is unreachable
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;errorfile&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/var/log/omelasticsearch.log&quot;&lt;/span&gt;
        )

    } &lt;span class=&quot;n&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;if&lt;/span&gt; $&lt;span class=&quot;n&quot;&gt;parsesuccess&lt;/span&gt; == &lt;span class=&quot;s2&quot;&gt;&quot;FAIL&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;then&lt;/span&gt; {
        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;omfile&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/tmp/json-parse-failure&quot;&lt;/span&gt;)
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To run Logstash we chose the quickest way, hence run it in Docker , so we have put all required Logstash configuration, logs and Maxmind databases in a directory:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;linux@linux-VM:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 linux linux 26331174 Aug   6 19:11 GeoIP2-ISP.mmdb
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 linux linux 51469823 Aug   6 19:11 GeoLite2-City.mmdb
&lt;span class=&quot;nt&quot;&gt;-rw-rw-r--&lt;/span&gt; 1 linux linux      107 Aug  18 19:13 input-geo.json
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 linux linux     2244 Aug  18 19:32 rsyslog.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running Rsyslog on Docker is not so relatively easy as the Docker images are a work in progress in &lt;a href=&quot;https://github.com/rsyslog/rsyslog-docker/&quot;&gt;Github&lt;/a&gt; (last checked 2018-08-18). So we created a custom image in our personal account, called &lt;a href=&quot;https://hub.docker.com/r/manios/rsyslog/&quot;&gt;manios/rsyslog&lt;/a&gt;. Let’s run a Docker container with Rsyslog 8.37.0:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; myrsyslog &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/GeoLite2-City.mmdb:/etc/rsyslog.d/GeoLite2-City.mmdb &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/GeoIP2-ISP.mmdb:/etc/rsyslog.d/GeoIP2-ISP.mmdb &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/input-geo.json:/opt/input-geo.json &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/rsyslog.conf:/etc/rsyslog.conf &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    manios/rsyslog:8.37.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now Rsyslog is running. Let’s run a Bash shell inside the container:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-it&lt;/span&gt; myrsyslog /bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While Rsyslog is running, if you examine the contents of &lt;code class=&quot;highlighter-rouge&quot;&gt;/tmp/json-output&lt;/code&gt; file, you will notice that the messages contain a lot of geolocation information and they will resemble to the following:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;@version&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;@timestamp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2018-08-18T06:59:14.640903+00:00&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;b576d0a6022b&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;syslog&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;syslog_timestamp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Aug 18 06:59:14&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;syslog_hostname&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;b576d0a6022b&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;syslog_program&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;geoip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;syslog_message&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;{&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Christos&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;src_ip&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;63.145.248.101&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:12}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;received_at&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2018-08-18T06:59:14.640903+00:00&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;received_from&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/opt/input-geo.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Christos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;63.145.248.101&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_geoip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;timezone&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;America&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Los_Angeles&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;latitude&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;37.925500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;longitude&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-122.343700&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dma_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;807&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;city_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;continent_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;NA&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;country_code2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;US&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;country_code3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;US&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;country_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;UnitedStates&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;postal_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;94804&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;region_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;region_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;asn&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;209&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;as_org&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;QwestCommunicationsCompany,LLC&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;isp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CenturyLink&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;organization&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CenturyLink&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;63.145.248.101&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;location&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lat&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;37.9255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lon&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-122.3437&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unfortunately, current version of Rsyslog contains a known bug (&lt;a href=&quot;https://github.com/rsyslog/rsyslog/issues/1650&quot;&gt;#1650&lt;/a&gt;) which strips the space characters from strings. Notice that&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;country_name&quot;: &quot;UnitedStates&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;should be&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;country_name&quot;: &quot;United States&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;for example. Also, if you compare to our previous post (&lt;code class=&quot;highlighter-rouge&quot;&gt;TODO add link here&lt;/code&gt;), &lt;code class=&quot;highlighter-rouge&quot;&gt;region_code&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;region_name&lt;/code&gt; should have a value. You can easily spot the differences between Rsyslog and Logstash output in the following image:&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/images/2018-08-18-rsyslog-geo-maxmind/maxmind-output-logstash-rsyslog.png&quot;&gt;&lt;img src=&quot;/images/2018-08-18-rsyslog-geo-maxmind/maxmind-output-logstash-rsyslog.png&quot; alt=&quot;Rsyslog and Logstash output diff when using Maxmind GeoIP City and ISP lookup databases&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;p&gt;We hope this article helped you get up and running with Rsyslog and the use of &lt;a href=&quot;https://www.rsyslog.com/doc/v8-stable/configuration/modules/mmdblookup.html&quot;&gt;MaxMind/GeoIP DB lookup (mmdblookup)&lt;/a&gt; module!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="rsyslog" /><category term="mmdblookup" /><category term="omelasticsearch" /><category term="geolocation" /><category term="ip" /><category term="geoip" /><category term="maxmind" /><category term="geo" /><category term="geoip" /><category term="geolite" /><category term="geolite2" /><category term="database" /><category term="json" /><category term="parse" /><category term="message" /><category term="log" /><summary type="html">Today we wanted to parse some json logs which we had in a file using Rsyslog and enrich them with Geolocation information regarding the city and the ISP an IP belongs. We initially tried with Logstash (see relevant previous blog post) but it was too slow. Thus we decided to try with parsing with Rsyslog. The file, let’s call it /var/log/input-geo.json had the following structure and content. (It is the same as in Logstash post):</summary></entry><entry><title type="html">Logstash - Enrich IP with Geolocation using Maxmind GeoLite2 City and ISP</title><link href="https://manios.org/2018/08/14/logstash-geoip-json-logs-maxmint-geolite-docker" rel="alternate" type="text/html" title="Logstash - Enrich IP with Geolocation using Maxmind GeoLite2 City and ISP" /><published>2018-08-14T18:35:00+03:00</published><updated>2018-08-14T18:35:00+03:00</updated><id>https://manios.org/2018/08/14/logstash-geoip-json-logs-maxmint-geolite-docker</id><content type="html" xml:base="https://manios.org/2018/08/14/logstash-geoip-json-logs-maxmint-geolite-docker">&lt;p&gt;Today we wanted to parse some json logs which we had in a file using Logstash and enrich  them with Geolocation information regarding the city and the ISP an IP belongs. The file, (let’s call it &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/log/input-geo.json&lt;/code&gt;) had the following structure:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Christos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;63.145.248.101&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Nikos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;98.158.156.175&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Logstash has &lt;a href=&quot;https://www.elastic.co/guide/en/logstash/current/plugins-filters-geoip.html&quot;&gt;GeoIP filter&lt;/a&gt; which adds information about the geographical location of IP addresses, based on data from the Maxmind GeoLite2 databases. In our case we used:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://dev.maxmind.com/geoip/geoip2/geolite2/&quot;&gt;GeoLite2 City&lt;/a&gt; database (free)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.maxmind.com/en/geoip2-isp-database&quot;&gt;GeoIP2 ISP &lt;/a&gt; Database (commercial licence)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We wanted to parse the JSON file enrich the &lt;code class=&quot;highlighter-rouge&quot;&gt;src_ip&lt;/code&gt; and then forward it to &lt;a href=&quot;https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html&quot;&gt;Elasticsearch&lt;/a&gt;. For debugging purposes we also enabled &lt;a href=&quot;https://www.elastic.co/guide/en/logstash/current/plugins-outputs-file.html&quot;&gt;file output&lt;/a&gt;. Thus , the configuration (&lt;code class=&quot;highlighter-rouge&quot;&gt;logstash.conf&lt;/code&gt;) looked like the following:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/var/log/input-geo.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sincedb_path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/logstash/geo-sincedb1&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;start_position&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;beginning&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;codec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;mygeo&quot;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;# Enhance with City geolocation information using free GeoLite2 City database&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src_ip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;geoip&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;src_geoip&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;database&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/logstash/GeoLite2-City.mmdb&quot;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;# Enhance with ISP geolocation information using free GeoIP2 ISP Database&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src_ip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;geoip&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;src_geoip&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;database&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/logstash/GeoIP2-ISP.mmdb&quot;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  

&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# stdout  { codec =&amp;gt; rubydebug }&lt;/span&gt;
     
    &lt;span class=&quot;c1&quot;&gt;# Output successfull messages to a file&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;_grokparsefailure&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/logstash/success-debug.txt&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;codec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;json_lines&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;#  codec =&amp;gt; rubydebug&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  
    &lt;span class=&quot;c1&quot;&gt;# Output failed messages to a file &lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;_grokparsefailure&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/logstash/failed-debug.txt&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;codec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rubydebug&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
 
    &lt;span class=&quot;c1&quot;&gt;# Output successfull messages to Elasticsearch&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;elasticsearch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;hosts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;192.168.1.3:9200&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;json_logs-%{+YYYY.MM.dd}&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;192.168.1.3_login_events-%{+YYYY.MM.dd}&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;manage_template&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;template_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;login_events&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;template_overwrite&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;protocol&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;flush_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;512&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;workers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To run Logstash we chose the quickest way, hence run it in Docker , so we have put all required Logstash configuration, logs and Maxmind databases in a directory:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;linux@linux-VM:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 linux linux 26331174 Aug   6 19:11 GeoIP2-ISP.mmdb
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 linux linux 51469823 Aug   6 19:11 GeoLite2-City.mmdb
&lt;span class=&quot;nt&quot;&gt;-rw-rw-r--&lt;/span&gt; 1 linux linux      107 Aug  13 19:13 input-geo.json
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 linux linux     2244 Aug  13 19:32 logstash.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running Logstash on Docker is relatively easy as Docker images for are available from the &lt;a href=&quot;https://www.docker.elastic.co/&quot;&gt;Elastic Docker registry&lt;/a&gt;. You can find more information &lt;a href=&quot;https://www.elastic.co/guide/en/logstash/current/docker.html&quot;&gt;here&lt;/a&gt;. Let’s run and interactive Docker container with Logstash 6.3.2:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run -it \
    --rm \
    --name logstash \
    -v $(pwd)/GeoIP2-ISP.mmdb:/usr/share/logstash/GeoIP2-ISP.mmdb \
    -v $(pwd)/GeoLite2-City.mmdb:/usr/share/logstash/GeoLite2-City.mmdb \
    -v $(pwd)/input-geo.json:/var/log/input-geo.json \
    -v $(pwd)/logstash.conf:/usr/share/logstash/pipeline/logstash.conf \
    docker.elastic.co/logstash/logstash-oss:6.3.2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While Logstash is running, if you examine Elasticsearch or &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/logstash/success-debug.txt&lt;/code&gt;, you will notice that the messages contain a lot of geolocation information and they will resemble to the following:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;63.145.248.101&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/var/log/input-geo.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;a14a2394ba12&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;@timestamp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2018-08-13T17:33:05.894Z&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;mygeo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_geoip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;postal_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;94804&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;country_code3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;US&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dma_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;807&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;continent_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;NA&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;region_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;California&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;longitude&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-122.3437&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;63.145.248.101&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;isp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CenturyLink&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;region_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CA&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;latitude&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;37.9255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;as_org&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Qwest Communications Company, LLC&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;country_code2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;US&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;asn&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;209&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;location&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lon&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-122.3437&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lat&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;37.9255&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;organization&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CenturyLink&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;city_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Richmond&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;country_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;United States&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;timezone&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;America/Los_Angeles&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Christos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;@version&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thank God we have a geolocation result! We hope this article helped you get up and running!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="logstash" /><category term="geolocation" /><category term="ip" /><category term="geoip" /><category term="maxmind" /><category term="geo" /><category term="geolite" /><category term="geolite2" /><category term="database" /><category term="json" /><category term="parse" /><category term="message" /><category term="log" /><summary type="html">Today we wanted to parse some json logs which we had in a file using Logstash and enrich them with Geolocation information regarding the city and the ISP an IP belongs. The file, (let’s call it /var/log/input-geo.json) had the following structure:</summary></entry><entry><title type="html">Creating a Beat based on Metricbeat resolving Init and create metricset failures</title><link href="https://manios.org/2018/07/23/create-a-beat-based-on-metricbeat-resolving-bugs" rel="alternate" type="text/html" title="Creating a Beat based on Metricbeat resolving Init and create metricset failures" /><published>2018-07-23T22:31:00+03:00</published><updated>2018-07-23T22:31:00+03:00</updated><id>https://manios.org/2018/07/23/create-a-beat-based-on-metricbeat-resolving-bugs</id><content type="html" xml:base="https://manios.org/2018/07/23/create-a-beat-based-on-metricbeat-resolving-bugs">&lt;p&gt;I suspect that you are reading this post after having trouble creating a new Elastic Beat based on Metricbeat. Bud do not worry! We have you covered and solved the issues for you!&lt;/p&gt;

&lt;p&gt;Long story short, a few days ago we wanted to create a new Metricbeat. After reading and executing step by step the official guide “&lt;a href=&quot;https://www.elastic.co/guide/en/beats/devguide/current/creating-beat-from-metricbeat.html&quot;&gt;Creating a Beat based on Metricbeat&lt;/a&gt;” we stumpled upon a series of issues like &lt;a href=&quot;https://discuss.elastic.co/t/step-3-init-and-create-the-metricset-failure/112046/12&quot;&gt;Step 3 - Init and create the metricset failure&lt;/a&gt;. After spending 2 days trying to resolve our local dependencies and solve the issues in our development environment, we decided to make everything in a sterilized environment, hence a Docker container.&lt;/p&gt;

&lt;p&gt;To begin with, we used Go language &lt;a href=&quot;https://hub.docker.com/_/golang/&quot;&gt;official Docker image&lt;/a&gt; with tag &lt;code class=&quot;highlighter-rouge&quot;&gt;golang:1.10.2-stretch&lt;/code&gt; and we run everything in it. So in a shell, we executed:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run -it --rm --name go1.10 golang:1.10.2-stretch /bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When the container is started, a new shell is loaded and we can download all the dependencies needed, by executing inside it:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;apt-get update &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; wget curl git vim &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;set number&quot;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;tee&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; /etc/vim/vimrc &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;syntax on&quot;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;tee&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; /etc/vim/vimrc &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;colorscheme evening&quot;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;tee&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; /etc/vim/vimrc  &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; wget https://bootstrap.pypa.io/get-pip.py &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; python get-pip.py &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rm &lt;/span&gt;get-pip.py &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pip &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;virtualenv &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Our environment:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;===================================&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; go version &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Python version: &quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; python &lt;span class=&quot;nt&quot;&gt;--version&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;virtualenv version: &quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; virtualenv &lt;span class=&quot;nt&quot;&gt;--version&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;===================================&quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Fetching metricbeat source code: &quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; go get github.com/elastic/beats/metricbeat &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[OK]&quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GOPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/src/github.com/elastic/beats &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Checking out commit 2619e137c1f7eb031fc89132045117a85c7ef818 to new branch in order to avoid bug&quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; git checkout &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; working 2619e137c1f7eb031fc89132045117a85c7ef818 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$GOPATH&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'s/@-cp -r module\/[*]\/_meta\/kibana _meta\//@-cp -r ${GOPATH}\/src\/github.com\/elastic\/beats\/metricbeat\/module\/*\/_meta\/kibana _meta\//'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GOPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/src/github.com/elastic/beats/metricbeat/Makefile &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Elastic beats environment has been initialised successfully! You can now generate a new Metricbeat!&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If everything works as expected you should see something like this in the output:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Our environment:
===================================
go version go1.10.2 linux/amd64
Python version: Python 2.7.13
virtualenv version: 16.0.0
===================================
Fetching metricbeat source code: [OK]
Checking out commit 2619e137c1f7eb031fc89132045117a85c7ef818 to new branch in order to avoid bug
Switched to a new branch 'working'
Elastic beats environment has been initialised successfully! You can now generate a new Metricbeat!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The environment is set up correctly. Let’s create a new Metricbeat. So execute:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;python ${GOPATH}/src/github.com/elastic/beats/script/generate.py --type=metricbeat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and respond to the input as the example:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@1e407b4d73a7:/go# python ${GOPATH}/src/github.com/elastic/beats/script/generate.py --type=metricbeat
Beat Name [Examplebeat]: weatherbeat
Your Github Name [your-github-name]: manios
Beat Path [github.com/manios/weatherbeat]:
Firstname Lastname: Christos Manios
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The newly created Metricbeat will be stored in &lt;code class=&quot;highlighter-rouge&quot;&gt;${GOPATH}/src/github.com/manios/weatherbeat/&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Navigate to the Metricbeat directory. Execute the following to avoid weird errors when creating a metricset:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GOPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/src/github.com/manios/weatherbeat &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$GOPATH&lt;/span&gt;/src/github.com/elastic/beats/metricbeat/scripts &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now we are ready to create a new Metricset. The metricset module will be called &lt;code class=&quot;highlighter-rouge&quot;&gt;skgtemperatures&lt;/code&gt; and the metricset itself &lt;code class=&quot;highlighter-rouge&quot;&gt;hydro&lt;/code&gt;. According to the official guide we execute &lt;code class=&quot;highlighter-rouge&quot;&gt;make setup&lt;/code&gt; and the output will be the following:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mkdir -p vendor/github.com/elastic/
cp -R /go/src/github.com/elastic/beats vendor/github.com/elastic/
rm -rf vendor/github.com/elastic/beats/.git
make create-metricset
make[1]: Entering directory '/go/src/github.com/manios/weatherbeat'
New python executable in /go/src/github.com/manios/weatherbeat/build/python-env/bin/python
Installing setuptools, pip, wheel...done.
docker-compose 1.22.0 has requirement requests!=2.11.0,!=2.12.2,!=2.18.0,&amp;lt;2.19,&amp;gt;=2.6.1, but you'll have requests 2.19.1 which is incompatible.
# Work around pip bug. See: https://github.com/pypa/pip/issues/4464
find /go/src/github.com/manios/weatherbeat/build/python-env -type d -name 'dist-packages' -exec sh -c &quot;echo dist-packages &amp;gt; {}.pth&quot; ';'
Module name: skgtemperature
Metricset name: hydro
Module skgtemperature created.
Metricset hydro created.
make[1]: Leaving directory '/go/src/github.com/manios/weatherbeat'
make collect
make[1]: Entering directory '/go/src/github.com/manios/weatherbeat'
# Work around pip bug. See: https://github.com/pypa/pip/issues/4464
find /go/src/github.com/manios/weatherbeat/build/python-env -type d -name 'dist-packages' -exec sh -c &quot;echo dist-packages &amp;gt; {}.pth&quot; ';'
make[1]: Leaving directory '/go/src/github.com/manios/weatherbeat'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If everything works as expected then if you execute a &lt;code class=&quot;highlighter-rouge&quot;&gt;tree&lt;/code&gt; command, to &lt;code class=&quot;highlighter-rouge&quot;&gt;module&lt;/code&gt; directory you will probably have the following structure:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- skgtemperature
    |-- _meta
    |   |-- config.yml
    |   |-- docs.asciidoc
    |   `-- fields.yml
    |-- doc.go
    `-- hydro
        |-- _meta
        |   |-- data.json
        |   |-- docs.asciidoc
        |   `-- fields.yml
        `-- hydro.go
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That’s it! I hope it helps!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="elastic" /><category term="metricbeat" /><category term="beats" /><category term="elasticsearch" /><category term="create" /><category term="generator" /><category term="go" /><category term="golang" /><category term="elk" /><category term="search" /><category term="kibana" /><category term="index" /><category term="monitor" /><summary type="html">I suspect that you are reading this post after having trouble creating a new Elastic Beat based on Metricbeat. Bud do not worry! We have you covered and solved the issues for you!</summary></entry><entry><title type="html">Git merge conflicts using Tortoise Git merge in Windows</title><link href="https://manios.org/2018/05/30/git-merge-conflicts-using-tortoise-git-merge-windows" rel="alternate" type="text/html" title="Git merge conflicts using Tortoise Git merge in Windows" /><published>2018-05-30T20:42:00+03:00</published><updated>2018-05-30T20:42:00+03:00</updated><id>https://manios.org/2018/05/30/git-merge-conflicts-using-tortoise-git-merge-windows</id><content type="html" xml:base="https://manios.org/2018/05/30/git-merge-conflicts-using-tortoise-git-merge-windows">&lt;p&gt;Today we wanted to use Tortoise Git Merge, a Windows Git utility which comes with &lt;a href=&quot;https://tortoisegit.org&quot;&gt;Tortoise Git&lt;/a&gt;. It helps us do a 3 way merge and solve our conflicts easily. The advantage of it is that it automatically merges the lines that where uniquely modified in every file and you only need to merge the common changes where the conflicts are. So in our case we had a file , let’s call it &lt;code class=&quot;highlighter-rouge&quot;&gt;README.md&lt;/code&gt;, in which we had 1000 changed lines out of which only 2 had a conflict with the file pulled from upstream server. Eclipse and IntelliJ do provide a merge editor but as far as we are concerned they are not automatically merging your unique changes (please correct us if we are wrong). After some searching on the web of how to do so, we found &lt;a href=&quot;https://stackoverflow.com/questions/5190188/why-cant-i-use-tortoisemerge-as-my-git-merge-tool-on-windows/19711169#19711169&quot;&gt;StackOverflow Question 5190188 : Why can’t I use TortoiseMerge as my git merge tool on Windows?&lt;/a&gt; which explains different approaches.&lt;/p&gt;

&lt;p&gt;So according to the aforementioned question and our experiments, in order to use Tortoise Git Merge you have to download and install &lt;a href=&quot;https://tortoisegit.org&quot;&gt;Tortoise Git&lt;/a&gt; and configure your local &lt;code class=&quot;highlighter-rouge&quot;&gt;.gitconfig&lt;/code&gt; file with the following lines:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[core]
	longpaths = true
	autocrlf = true
[merge]
	tool=tortoisemerge
[mergetool &quot;tortoisemerge&quot;]
	cmd = \&quot;C:\\Program Files\\TortoiseGit\\bin\\TortoiseGitMerge.exe\&quot; -base:\&quot;$BASE\&quot; -theirs:\&quot;$LOCAL\&quot; -mine:\&quot;$REMOTE\&quot; -merged:\&quot;$MERGED\&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you want an one liner equivalent command, you can run the following:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git config --global mergetool.tortoisemerge.cmd &quot;\&quot;C:\\Program Files\\TortoiseGit\\bin\\TortoiseGitMerge.exe\&quot; -base:\&quot;$BASE\&quot; -theirs:\&quot;$LOCAL\&quot; -mine:\&quot;$REMOTE\&quot; -merged:\&quot;$MERGED\&quot;&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;NOTE:
The &lt;code class=&quot;highlighter-rouge&quot;&gt;core&lt;/code&gt; section is complimentary for Windows in order to help Git use long paths and overcome Windows 260 character &lt;a href=&quot;https://msdn.microsoft.com/en-us/library/windows/desktop/aa365247(v=vs.85).aspx&quot;&gt;MAX_PATH&lt;/a&gt; limitation. Furthermore we need to automatically checkout with file ending using &lt;code class=&quot;highlighter-rouge&quot;&gt;CRLF&lt;/code&gt; and push to &lt;code class=&quot;highlighter-rouge&quot;&gt;LF&lt;/code&gt;, thus the &lt;code class=&quot;highlighter-rouge&quot;&gt;autocrlf&lt;/code&gt; is set to &lt;code class=&quot;highlighter-rouge&quot;&gt;true&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;After this short parenthesis, back in action! When you pull from a remote repository, or you merge, or rebase a branch and Git complains about conflicts you can use in your shell or in &lt;a href=&quot;https://gitforwindows.org/&quot;&gt;Git Bash&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git mergetool
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Tortoise merge will appear with a display like the following:&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/images/2018-05-30-git-merge-with-tortoise-git/tortoiseMerge3WayMerge.png&quot;&gt;&lt;img src=&quot;/images/2018-05-30-git-merge-with-tortoise-git/tortoiseMerge3WayMerge.png&quot; alt=&quot;Tortoise merge open to merge conflicts&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;p&gt;In this image, conflicts are marked with red and the automatically merged lines are marked with yellow. Left side (Theirs) is the version of the file which comes from repository and right side (Mine) is your local version with your changes.&lt;/p&gt;

&lt;p&gt;That’s it. We hope this quick guide helped you!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="git" /><category term="merge" /><category term="mergetool" /><category term="tortoise" /><category term="conflict" /><category term="windows" /><category term="client" /><summary type="html">Today we wanted to use Tortoise Git Merge, a Windows Git utility which comes with Tortoise Git. It helps us do a 3 way merge and solve our conflicts easily. The advantage of it is that it automatically merges the lines that where uniquely modified in every file and you only need to merge the common changes where the conflicts are. So in our case we had a file , let’s call it README.md, in which we had 1000 changed lines out of which only 2 had a conflict with the file pulled from upstream server. Eclipse and IntelliJ do provide a merge editor but as far as we are concerned they are not automatically merging your unique changes (please correct us if we are wrong). After some searching on the web of how to do so, we found StackOverflow Question 5190188 : Why can’t I use TortoiseMerge as my git merge tool on Windows? which explains different approaches.</summary></entry><entry><title type="html">Debug HTTP request of Java SOAP JAX-WS web service client</title><link href="https://manios.org/2018/04/03/java-soap-service-client-debug-http-message" rel="alternate" type="text/html" title="Debug HTTP request of Java SOAP JAX-WS web service client" /><published>2018-04-03T19:42:00+03:00</published><updated>2018-04-03T19:42:00+03:00</updated><id>https://manios.org/2018/04/03/java-soap-service-client-debug-http-message</id><content type="html" xml:base="https://manios.org/2018/04/03/java-soap-service-client-debug-http-message">&lt;p&gt;Today I wanted to debug in Java a JAX-WS SOAP web service client and see the exact message that is send as an &lt;a href=&quot;https://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html&quot;&gt;HTTP request&lt;/a&gt;. So after searching, I found in this   &lt;a href=&quot;https://stackoverflow.com/questions/1945618/tracing-xml-request-responses-with-jax-ws&quot;&gt;StackOverflow question&lt;/a&gt; that if we insert the following lines before calling the service:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setProperty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;com.sun.xml.ws.transport.http.client.HttpTransportPipe.dump&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setProperty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;com.sun.xml.internal.ws.transport.http.client.HttpTransportPipe.dump&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setProperty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;com.sun.xml.ws.transport.http.HttpAdapter.dump&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setProperty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;com.sun.xml.internal.ws.transport.http.HttpAdapter.dump&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;when we call the service it will produce the following output in logs (or console output):&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-txt&quot;&gt;---[HTTP request - http://localhost:9090/ContactRequestServicePort]---
Accept: text/xml, multipart/related
Content-Type: text/xml; charset=utf-8
SOAPAction: &quot;newContact&quot;
User-Agent: JAX-WS RI 2.2.9-b130926.1035 svn-revision#5f6196f2b90e9460065a4c2f4e30e065b245e51e
&amp;lt;?xml version=&quot;1.0&quot; ?&amp;gt;&amp;lt;S:Envelope xmlns:S=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&amp;gt;&amp;lt;S:Body&amp;gt;&amp;lt;ns2:newContact xmlns:ns4=&quot;http://www.acmecorp.com/contacts/Exception&quot; xmlns:ns3=&quot;http://www.acmecorp.com/contacts/RequestMetaInfo&quot; xmlns:ns2=&quot;http://www.acmecorp.com/contacts/crm-contact/Service&quot;&amp;gt;&amp;lt;ns2:contact&amp;gt;&amp;lt;ns2:prefix&amp;gt;Mr&amp;lt;/ns2:prefix&amp;gt;&amp;lt;ns2:name&amp;gt;John&amp;lt;/ns2:name&amp;gt;&amp;lt;ns2:surname&amp;gt;Longjohn&amp;lt;/ns2:surname&amp;gt;&amp;lt;/ns2:contact&amp;gt;&amp;lt;/ns2:newContact&amp;gt;&amp;lt;/S:Body&amp;gt;&amp;lt;/S:Envelope&amp;gt;--------------------
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;It works! Now we have the entire HTTP request and we can pretty print the XML which is included in the message body of HTTP request to see what we send to the web service:&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; ?&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;S:Envelope&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:S=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;S:Body&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;ns2:newContact&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:ns4=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.acmecorp.com/contacts/Exception&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:ns3=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.acmecorp.com/contacts/RequestMetaInfo&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:ns2=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.acmecorp.com/contacts/crm-contact/Service&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;ns2:contact&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;nt&quot;&gt;&amp;lt;ns2:prefix&amp;gt;&lt;/span&gt;Mr&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ns2:prefix&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;nt&quot;&gt;&amp;lt;ns2:name&amp;gt;&lt;/span&gt;John&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ns2:name&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;nt&quot;&gt;&amp;lt;ns2:surname&amp;gt;&lt;/span&gt;Longjohn&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ns2:surname&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;/ns2:contact&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/ns2:newContact&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/S:Body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/S:Envelope&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>cmanios</name></author><category term="java" /><category term="http" /><category term="request" /><category term="message" /><category term="debug" /><category term="soap" /><category term="client" /><category term="jax" /><category term="ws" /><category term="jax-ws" /><category term="web" /><category term="service" /><category term="print" /><category term="log" /><category term="console" /><category term="wsdl" /><summary type="html">Today I wanted to debug in Java a JAX-WS SOAP web service client and see the exact message that is send as an HTTP request. So after searching, I found in this StackOverflow question that if we insert the following lines before calling the service:</summary></entry><entry><title type="html">HTTP Basic Authentication in Java SOAP JAX-WS web service client</title><link href="https://manios.org/2018/03/30/java-soap-jax-ws-client-basic-auth" rel="alternate" type="text/html" title="HTTP Basic Authentication in Java SOAP JAX-WS web service client" /><published>2018-03-30T17:42:00+03:00</published><updated>2018-03-30T17:42:00+03:00</updated><id>https://manios.org/2018/03/30/java-soap-jax-ws-client-basic-auth</id><content type="html" xml:base="https://manios.org/2018/03/30/java-soap-jax-ws-client-basic-auth">&lt;p&gt;Today I had to create a Java client for a SOAP web service. So I opened &lt;a href=&quot;http://netbeans.org/&quot;&gt;Netbeans&lt;/a&gt; IDE and used the great tool which generates JAX-WS client code using the respective service &lt;code class=&quot;highlighter-rouge&quot;&gt;.wsdl&lt;/code&gt; file. However, the service needed to be called using &lt;a href=&quot;https://en.wikipedia.org/wiki/Basic_access_authentication&quot;&gt;Basic Http Authentication&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt;: The solution provided works if the WSDL is not protected itself by Basic Http Authentication. The Basic Authentication &lt;u&gt;is added as a header in the HTTP request&lt;/u&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;After a lot of searching I found that (StackOverflow question) this is possible:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;ContactCreationRequestService_Service&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;srv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ContactCreationRequestService_Service&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ContactCreationRequestService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;porta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Get service port&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;porta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;srv&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getContactCreationRequestServicePort&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Add username and password for Basic Authentication&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reqContext&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BindingProvider&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;porta&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getRequestContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;reqContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BindingProvider&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;USERNAME_PROPERTY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;reqContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BindingProvider&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;PASSWORD_PROPERTY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Create a contact request&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ContactRequest&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ka&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ContactRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ka&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setPrefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Mr&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ka&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Christos&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ka&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setSurname&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Manios&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;NewContact&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nka&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NewContact&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;nka&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setContactRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ka&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Call the web service&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;porta&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;newContactCreationRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nka&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SoapServiceException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we enable debugging to see the actual HTTP request, then the logs will show output like the following:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---[HTTP request - http://localhost:9090/ContactRequestServicePort]---
Accept: text/xml, multipart/related
Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=
Content-Type: text/xml; charset=utf-8
SOAPAction: &quot;newContact&quot;
User-Agent: JAX-WS RI 2.2.9-b130926.1035 svn-revision#5f6196f2b90e9460065a4c2f4e30e065b245e51e
&amp;lt;?xml version=&quot;1.0&quot; ?&amp;gt;&amp;lt;S:Envelope xmlns:S=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&amp;gt;&amp;lt;S:Body&amp;gt;&amp;lt;ns2:newContact xmlns:ns4=&quot;http://www.acmecorp.com/contacts/Exception&quot; xmlns:ns3=&quot;http://www.acmecorp.com/contacts/RequestMetaInfo&quot; xmlns:ns2=&quot;http://www.acmecorp.com/contacts/crm-contact/Service&quot;&amp;gt;&amp;lt;ns2:contact&amp;gt;&amp;lt;ns2:prefix&amp;gt;Mr&amp;lt;/ns2:prefix&amp;gt;&amp;lt;ns2:name&amp;gt;John&amp;lt;/ns2:name&amp;gt;&amp;lt;ns2:surname&amp;gt;Longjohn&amp;lt;/ns2:surname&amp;gt;&amp;lt;/ns2:contact&amp;gt;&amp;lt;/ns2:newContact&amp;gt;&amp;lt;/S:Body&amp;gt;&amp;lt;/S:Envelope&amp;gt;--------------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can observe that the request contains the &lt;code class=&quot;highlighter-rouge&quot;&gt;Authorization&lt;/code&gt; header as expected:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>cmanios</name></author><category term="java" /><category term="soap" /><category term="basic" /><category term="auth" /><category term="authentication" /><category term="client" /><category term="jax" /><category term="ws" /><category term="jax-ws" /><category term="web" /><category term="service" /><category term="http" /><category term="netbeans" /><category term="wsdl" /><summary type="html">Today I had to create a Java client for a SOAP web service. So I opened Netbeans IDE and used the great tool which generates JAX-WS client code using the respective service .wsdl file. However, the service needed to be called using Basic Http Authentication.</summary></entry></feed>