<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.0">Jekyll</generator><link href="https://manios.org/feed.xml" rel="self" type="application/atom+xml" /><link href="https://manios.org/" rel="alternate" type="text/html" /><updated>2018-08-18T13:27:32+03:00</updated><id>https://manios.org/</id><title type="html">cmanios</title><subtitle>Developer life is a NullPointerException</subtitle><author><name>Christos Manios</name></author><entry><title type="html">Rsyslog - Parse Json and enrich IP with Geolocation using Maxmind GeoLite2 City and ISP</title><link href="https://manios.org/2018/08/18/logstash-geoip-json-logs-maxmint-geolite-docker" rel="alternate" type="text/html" title="Rsyslog - Parse Json and enrich IP with Geolocation using Maxmind GeoLite2 City and ISP" /><published>2018-08-18T10:13:44+03:00</published><updated>2018-08-18T10:13:44+03:00</updated><id>https://manios.org/2018/08/18/logstash-geoip-json-logs-maxmint-geolite-docker</id><content type="html" xml:base="https://manios.org/2018/08/18/logstash-geoip-json-logs-maxmint-geolite-docker">&lt;p&gt;Today we wanted to parse some json logs which we had in a file using &lt;a href=&quot;http://rsyslog.com/&quot;&gt;Rsyslog&lt;/a&gt; and enrich  them with Geolocation information regarding the city and the ISP an IP belongs. We initially tried with Logstash (see relevant &lt;a href=&quot;/2018/08/14/logstash-geoip-json-logs-maxmint-geolite-docker&quot;&gt;previous blog post&lt;/a&gt;) but it was too slow. Thus we decided to try with parsing with Rsyslog. The file, let’s call it &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/log/input-geo.json&lt;/code&gt; had the following structure and content. (It is the same as in Logstash post):&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Christos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;63.145.248.101&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Nikos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;98.158.156.175&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Rsyslog has &lt;a href=&quot;https://www.rsyslog.com/doc/v8-stable/configuration/modules/mmdblookup.html&quot;&gt;MaxMind/GeoIP DB lookup (mmdblookup)&lt;/a&gt; module which adds information about the geographical location of IP addresses, based on data from the Maxmind GeoLite2 databases. In our case we used:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://dev.maxmind.com/geoip/geoip2/geolite2/&quot;&gt;GeoLite2 City&lt;/a&gt; database (free)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.maxmind.com/en/geoip2-isp-database&quot;&gt;GeoIP2 ISP &lt;/a&gt; Database (commercial licence)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We wanted to parse the JSON file enrich the &lt;code class=&quot;highlighter-rouge&quot;&gt;src_ip&lt;/code&gt; field and store the geolocation information to &lt;code class=&quot;highlighter-rouge&quot;&gt;src_geoip&lt;/code&gt;. Then we forward the message to Elasticsearch using &lt;a href=&quot;https://www.rsyslog.com/doc/v8-stable/configuration/modules/omelasticsearch.html&quot;&gt;omelasticsearch: Elasticsearch Output Module&lt;/a&gt;. For debugging purposes we also enabled &lt;a href=&quot;https://www.elastic.co/guide/en/logstash/current/plugins-outputs-file.html&quot;&gt;file output&lt;/a&gt;. Thus , the configuration (&lt;code class=&quot;highlighter-rouge&quot;&gt;rsyslog.conf&lt;/code&gt;) looked like the following:&lt;/p&gt;

&lt;div class=&quot;language-conf highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#  /etc/rsyslog.conf	Configuration file for rsyslog.
#
#			For more information see
#			/usr/share/doc/rsyslog-doc/html/rsyslog_conf.html
#
#  Default logging rules can be found in /etc/rsyslog.d/50-default.conf
&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#################
#### MODULES ####
#################
&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imuxsock&quot;&lt;/span&gt;) &lt;span class=&quot;c&quot;&gt;# provides support for local system logging
# module(load=&quot;imklog&quot;)   # provides kernel logging support
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;immark&quot;&lt;/span&gt;)  &lt;span class=&quot;c&quot;&gt;# provides --MARK-- message capability
# $ModLoad imuxsock # provides support for local system logging
# $ModLoad imklog   # provides kernel logging support (previously done by rklogd)
#$ModLoad immark  # provides --MARK-- message capability
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# provides UDP syslog reception
# $ModLoad imudp
# $UDPServerRun 514
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# provides TCP syslog reception
# $ModLoad imtcp
# $InputTCPServerRun 514
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;builtin:omfile&quot;&lt;/span&gt;)
&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;mmnormalize&quot;&lt;/span&gt;) &lt;span class=&quot;c&quot;&gt;# parser using liblognorm
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;mmjsonparse&quot;&lt;/span&gt;) &lt;span class=&quot;c&quot;&gt;#for parsing CEE-enhanced syslog messages
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imfile&quot;&lt;/span&gt;)
&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;mmdblookup&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;container&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;!src_geo&quot;&lt;/span&gt;)

&lt;span class=&quot;c&quot;&gt;###########################
#### GLOBAL DIRECTIVES ####
###########################
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#
# Use traditional timestamp format.
# To enable high precision timestamps, comment out the following line.
#
&lt;/span&gt;$&lt;span class=&quot;n&quot;&gt;ActionFileDefaultTemplate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RSYSLOG_TraditionalFileFormat&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Filter duplicated messages
&lt;/span&gt;$&lt;span class=&quot;n&quot;&gt;RepeatedMsgReduction&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#
# Set the default permissions for all log files.
#
&lt;/span&gt;$&lt;span class=&quot;n&quot;&gt;FileOwner&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;
$&lt;span class=&quot;n&quot;&gt;FileGroup&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;
$&lt;span class=&quot;n&quot;&gt;FileCreateMode&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0640&lt;/span&gt;
$&lt;span class=&quot;n&quot;&gt;DirCreateMode&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0755&lt;/span&gt;
$&lt;span class=&quot;n&quot;&gt;Umask&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0022&lt;/span&gt;
$&lt;span class=&quot;n&quot;&gt;PrivDropToUser&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;syslog&lt;/span&gt;
$&lt;span class=&quot;n&quot;&gt;PrivDropToGroup&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;syslog&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# General globals
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;global&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;net&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;enableDNS&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;off&quot;&lt;/span&gt;)

&lt;span class=&quot;c&quot;&gt;# Remove Control Chars
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;global&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;parser&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;escapeControlCharactersOnReceive&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;off&quot;&lt;/span&gt; )

&lt;span class=&quot;c&quot;&gt;#
# Where to place spool files
#
&lt;/span&gt;$&lt;span class=&quot;n&quot;&gt;WorkDirectory&lt;/span&gt; /&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;spool&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;rsyslog&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;global&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;workDirectory&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/var/spool/rsyslog&quot;&lt;/span&gt;)
&lt;span class=&quot;c&quot;&gt;#
# Include all config files in /etc/rsyslog.d/
#
# $IncludeConfig /etc/rsyslog.d/*.conf
&lt;/span&gt;


&lt;span class=&quot;c&quot;&gt;#################
#### Inputs  ####
#################
&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# provides UDP syslog reception
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imudp&quot;&lt;/span&gt;)
&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imudp&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;514&quot;&lt;/span&gt;)

&lt;span class=&quot;c&quot;&gt;# provides TCP syslog reception
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imtcp&quot;&lt;/span&gt;)
&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imtcp&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;514&quot;&lt;/span&gt; )

&lt;span class=&quot;c&quot;&gt;# File 1
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;imfile&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/opt/input-geo.json&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;Tag&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;geoip&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;PersistStateInterval&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;freshStartTail&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;off&quot;&lt;/span&gt;)

&lt;span class=&quot;c&quot;&gt;#################
### Templates ###
#################
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# this is for formatting our syslog in JSON with @timestamp for Json messages
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;geoip&quot;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;list&quot;&lt;/span&gt;) {
    &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;{&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;@&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;\&lt;span class=&quot;s2&quot;&gt;&quot;:\&quot;&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;@timestamp\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)		&lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;timegenerated&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dateFormat&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;rfc3339&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;host\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)			    &lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;hostname&quot;&lt;/span&gt;) 
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;type\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;syslog&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;syslog_timestamp\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)	&lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;timereported&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dateFormat&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;rfc3164&quot;&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;syslog_hostname\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)	&lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;hostname&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;syslog_program\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)	&lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;programname&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;syslog_message\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)	&lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;msg&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;received_at\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)		&lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;timegenerated&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dateFormat&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;rfc3339&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;received_from\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)	    &lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;fromhost&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;path\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)      	    &lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;$!metadata!filename&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;name\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)              &lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;$!name&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;src_ip\&quot;&lt;/span&gt;:\&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)            &lt;span class=&quot;n&quot;&gt;property&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;$!src_ip&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;,\&lt;span class=&quot;s2&quot;&gt;&quot;src_geoip\&quot;&lt;/span&gt;:{&lt;span class=&quot;s2&quot;&gt;&quot;)          property(name=&quot;&lt;/span&gt;$!&lt;span class=&quot;n&quot;&gt;src_geo&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; position.from=&quot;&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&quot;&lt;/span&gt;)
      &lt;span class=&quot;n&quot;&gt;constant&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;}\n&quot;&lt;/span&gt;)
}


&lt;span class=&quot;c&quot;&gt;#################
#### Actions ####
#################
&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;###Fix text to utf8, disabled for now
###action(type=&quot;mmutf8fix&quot;)
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#action(type=&quot;omfile&quot; file=&quot;/tmp/logtesting&quot; template=&quot;RSYSLOG_DebugFormat&quot;)
&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;if&lt;/span&gt; ($&lt;span class=&quot;n&quot;&gt;syslogtag&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contains&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'geoip'&lt;/span&gt;) &lt;span class=&quot;n&quot;&gt;then&lt;/span&gt; {
    
    
    &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;mmjsonparse&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cookie&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;)
    
    &lt;span class=&quot;n&quot;&gt;if&lt;/span&gt; $&lt;span class=&quot;n&quot;&gt;parsesuccess&lt;/span&gt; == &lt;span class=&quot;s2&quot;&gt;&quot;OK&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;then&lt;/span&gt; {

        &lt;span class=&quot;c&quot;&gt;# https://github.com/rsyslog/rsyslog/issues/1650
&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;# Add MaxMind/GeoIP DB lookup information
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;( &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;mmdblookup&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mmdbfile&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/etc/rsyslog.d/GeoLite2-City.mmdb&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;!src_ip&quot;&lt;/span&gt; 
                &lt;span class=&quot;n&quot;&gt;fields&lt;/span&gt;=[&lt;span class=&quot;s2&quot;&gt;&quot;:timezone:!location!time_zone&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:latitude:!location!latitude&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:longitude:!location!longitude&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:dma_code:!location!metro_code&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:city_name:!names!en&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:continent_code:!continent!code&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:country_code2:!country!iso_code&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:country_code3:!country!iso_code&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:country_name:!country!names!en&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:postal_code:!postal!code&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:region_code:!subdivisions!iso_code&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:region_name:!subdivisions!names!en&quot;&lt;/span&gt;
                        ]
        )

        &lt;span class=&quot;c&quot;&gt;# Add MaxMind/GeoIP ISP DB lookup information
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;( &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;mmdblookup&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mmdbfile&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/etc/rsyslog.d/GeoIP2-ISP.mmdb&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;!src_ip&quot;&lt;/span&gt; 
                &lt;span class=&quot;n&quot;&gt;fields&lt;/span&gt;=[&lt;span class=&quot;s2&quot;&gt;&quot;:asn:!autonomous_system_number&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;:as_org:!autonomous_system_organization&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;!isp&quot;&lt;/span&gt;,
                        &lt;span class=&quot;s2&quot;&gt;&quot;!organization&quot;&lt;/span&gt;
                        ]
        )
        
        &lt;span class=&quot;c&quot;&gt;# Add IP to src_geo object
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;set&lt;/span&gt; $!&lt;span class=&quot;n&quot;&gt;src_geo&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;ip&lt;/span&gt; = $!&lt;span class=&quot;n&quot;&gt;src_ip&lt;/span&gt;;

        &lt;span class=&quot;c&quot;&gt;# If geolocation was successful, add lat,lon in a special location object
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;if&lt;/span&gt; $! &lt;span class=&quot;n&quot;&gt;contains&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'latitude'&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;then&lt;/span&gt; {
            &lt;span class=&quot;n&quot;&gt;set&lt;/span&gt; $!&lt;span class=&quot;n&quot;&gt;src_geo&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt; = $!&lt;span class=&quot;n&quot;&gt;src_geo&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;latitude&lt;/span&gt;;
            &lt;span class=&quot;n&quot;&gt;set&lt;/span&gt; $!&lt;span class=&quot;n&quot;&gt;src_geo&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;lon&lt;/span&gt; = $!&lt;span class=&quot;n&quot;&gt;src_geo&lt;/span&gt;!&lt;span class=&quot;n&quot;&gt;longitude&lt;/span&gt;;
        }

        &lt;span class=&quot;c&quot;&gt;# Output to a new file
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;omfile&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/tmp/json-output&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;geoip&quot;&lt;/span&gt;)

        &lt;span class=&quot;c&quot;&gt;# Output to Elasticsearch
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;omelasticsearch&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;192.168.1.10&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;serverport&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;9200&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;geoip&quot;&lt;/span&gt;  
            &lt;span class=&quot;n&quot;&gt;searchIndex&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;geoindex&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;dynSearchIndex&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;on&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;searchType&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;syslog&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;bulkmode&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;on&quot;&lt;/span&gt;                   &lt;span class=&quot;c&quot;&gt;# use the Bulk API
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;dequeuebatchsize&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;5000&quot;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# ES bulk size
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;100000&quot;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# capacity of the action queue
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;workerthreads&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;5&quot;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# 5 workers for the action
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;resumeretrycount&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;-1&quot;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# retry indefinitely if ES is unreachable
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;errorfile&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/var/log/omelasticsearch.log&quot;&lt;/span&gt;
        )

    } &lt;span class=&quot;n&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;if&lt;/span&gt; $&lt;span class=&quot;n&quot;&gt;parsesuccess&lt;/span&gt; == &lt;span class=&quot;s2&quot;&gt;&quot;FAIL&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;then&lt;/span&gt; {
        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;(&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;omfile&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;/tmp/json-parse-failure&quot;&lt;/span&gt;)
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To run Logstash we chose the quickest way, hence run it in Docker , so we have put all required Logstash configuration, logs and Maxmind databases in a directory:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;linux@linux-VM:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 linux linux 26331174 Aug   6 19:11 GeoIP2-ISP.mmdb
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 linux linux 51469823 Aug   6 19:11 GeoLite2-City.mmdb
&lt;span class=&quot;nt&quot;&gt;-rw-rw-r--&lt;/span&gt; 1 linux linux      107 Aug  18 19:13 input-geo.json
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 linux linux     2244 Aug  18 19:32 rsyslog.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running Rsyslog on Docker is not so relatively easy as the Docker images are a work in progress in &lt;a href=&quot;https://github.com/rsyslog/rsyslog-docker/&quot;&gt;Github&lt;/a&gt; (last checked 2018-08-18). So we created a custom image in our personal account, called &lt;a href=&quot;https://hub.docker.com/r/manios/rsyslog/&quot;&gt;manios/rsyslog&lt;/a&gt;. Let’s run a Docker container with Rsyslog 8.37.0:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; myrsyslog &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/GeoLite2-City.mmdb:/etc/rsyslog.d/GeoLite2-City.mmdb &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/GeoIP2-ISP.mmdb:/etc/rsyslog.d/GeoIP2-ISP.mmdb &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/input-geo.json:/opt/input-geo.json &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/rsyslog.conf:/etc/rsyslog.conf &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    manios/rsyslog:8.37.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now Rsyslog is running. Let’s run a Bash shell inside the container:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-it&lt;/span&gt; myrsyslog /bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While Rsyslog is running, if you examine the contents of &lt;code class=&quot;highlighter-rouge&quot;&gt;/tmp/json-output&lt;/code&gt; file, you will notice that the messages contain a lot of geolocation information and they will resemble to the following:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;@version&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;@timestamp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2018-08-18T06:59:14.640903+00:00&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;b576d0a6022b&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;syslog&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;syslog_timestamp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Aug 18 06:59:14&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;syslog_hostname&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;b576d0a6022b&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;syslog_program&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;geoip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;syslog_message&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;{&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Christos&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;src_ip&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;63.145.248.101&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:12}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;received_at&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2018-08-18T06:59:14.640903+00:00&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;received_from&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/opt/input-geo.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Christos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;63.145.248.101&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_geoip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;timezone&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;America&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Los_Angeles&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;latitude&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;37.925500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;longitude&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-122.343700&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dma_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;807&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;city_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;continent_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;NA&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;country_code2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;US&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;country_code3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;US&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;country_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;UnitedStates&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;postal_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;94804&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;region_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;region_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;asn&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;209&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;as_org&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;QwestCommunicationsCompany,LLC&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;isp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CenturyLink&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;organization&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CenturyLink&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;63.145.248.101&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;location&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lat&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;37.9255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lon&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-122.3437&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unfortunately, current version of Rsyslog contains a known bug (&lt;a href=&quot;https://github.com/rsyslog/rsyslog/issues/1650&quot;&gt;#1650&lt;/a&gt;) which strips the space characters from strings. Notice that&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;country_name&quot;: &quot;UnitedStates&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;should be&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;country_name&quot;: &quot;United States&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;for example. Also, if you compare to our previous post (&lt;code class=&quot;highlighter-rouge&quot;&gt;TODO add link here&lt;/code&gt;), &lt;code class=&quot;highlighter-rouge&quot;&gt;region_code&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;region_name&lt;/code&gt; should have a value. You can easily spot the differences between Rsyslog and Logstash output in the following image:&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/images/2018-08-18-rsyslog-geo-maxmind/maxmind-output-logstash-rsyslog.png&quot;&gt;&lt;img src=&quot;/images/2018-08-18-rsyslog-geo-maxmind/maxmind-output-logstash-rsyslog.png&quot; alt=&quot;Rsyslog and Logstash output diff when using Maxmind GeoIP City and ISP lookup databases&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;p&gt;We hope this article helped you get up and running with Rsyslog and the use of &lt;a href=&quot;https://www.rsyslog.com/doc/v8-stable/configuration/modules/mmdblookup.html&quot;&gt;MaxMind/GeoIP DB lookup (mmdblookup)&lt;/a&gt; module!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="rsyslog" /><category term="mmdblookup" /><category term="omelasticsearch" /><category term="geolocation" /><category term="ip" /><category term="geoip" /><category term="maxmind" /><category term="geo" /><category term="geoip" /><category term="geolite" /><category term="geolite2" /><category term="database" /><category term="json" /><category term="parse" /><category term="message" /><category term="log" /><summary type="html">Today we wanted to parse some json logs which we had in a file using Rsyslog and enrich them with Geolocation information regarding the city and the ISP an IP belongs. We initially tried with Logstash (see relevant previous blog post) but it was too slow. Thus we decided to try with parsing with Rsyslog. The file, let’s call it /var/log/input-geo.json had the following structure and content. (It is the same as in Logstash post):</summary></entry><entry><title type="html">Logstash - Enrich IP with Geolocation using Maxmind GeoLite2 City and ISP</title><link href="https://manios.org/2018/08/14/logstash-geoip-json-logs-maxmint-geolite-docker" rel="alternate" type="text/html" title="Logstash - Enrich IP with Geolocation using Maxmind GeoLite2 City and ISP" /><published>2018-08-14T18:35:00+03:00</published><updated>2018-08-14T18:35:00+03:00</updated><id>https://manios.org/2018/08/14/logstash-geoip-json-logs-maxmint-geolite-docker</id><content type="html" xml:base="https://manios.org/2018/08/14/logstash-geoip-json-logs-maxmint-geolite-docker">&lt;p&gt;Today we wanted to parse some json logs which we had in a file using Logstash and enrich  them with Geolocation information regarding the city and the ISP an IP belongs. The file, (let’s call it &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/log/input-geo.json&lt;/code&gt;) had the following structure:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Christos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;63.145.248.101&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Nikos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;98.158.156.175&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Logstash has &lt;a href=&quot;https://www.elastic.co/guide/en/logstash/current/plugins-filters-geoip.html&quot;&gt;GeoIP filter&lt;/a&gt; which adds information about the geographical location of IP addresses, based on data from the Maxmind GeoLite2 databases. In our case we used:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://dev.maxmind.com/geoip/geoip2/geolite2/&quot;&gt;GeoLite2 City&lt;/a&gt; database (free)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.maxmind.com/en/geoip2-isp-database&quot;&gt;GeoIP2 ISP &lt;/a&gt; Database (commercial licence)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We wanted to parse the JSON file enrich the &lt;code class=&quot;highlighter-rouge&quot;&gt;src_ip&lt;/code&gt; and then forward it to &lt;a href=&quot;https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html&quot;&gt;Elasticsearch&lt;/a&gt;. For debugging purposes we also enabled &lt;a href=&quot;https://www.elastic.co/guide/en/logstash/current/plugins-outputs-file.html&quot;&gt;file output&lt;/a&gt;. Thus , the configuration (&lt;code class=&quot;highlighter-rouge&quot;&gt;logstash.conf&lt;/code&gt;) looked like the following:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/var/log/input-geo.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sincedb_path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/logstash/geo-sincedb1&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;start_position&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;beginning&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;codec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;json&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;mygeo&quot;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;# Enhance with City geolocation information using free GeoLite2 City database&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src_ip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;geoip&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;src_geoip&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;database&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/logstash/GeoLite2-City.mmdb&quot;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;# Enhance with ISP geolocation information using free GeoIP2 ISP Database&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src_ip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;geoip&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;src_geoip&quot;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;database&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/logstash/GeoIP2-ISP.mmdb&quot;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  

&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# stdout  { codec =&amp;gt; rubydebug }&lt;/span&gt;
     
    &lt;span class=&quot;c1&quot;&gt;# Output successfull messages to a file&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;_grokparsefailure&quot;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/logstash/success-debug.txt&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;codec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;json_lines&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;#  codec =&amp;gt; rubydebug&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  
    &lt;span class=&quot;c1&quot;&gt;# Output failed messages to a file &lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;_grokparsefailure&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/logstash/failed-debug.txt&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;codec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rubydebug&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
 
    &lt;span class=&quot;c1&quot;&gt;# Output successfull messages to Elasticsearch&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;elasticsearch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;hosts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;192.168.1.3:9200&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;json_logs-%{+YYYY.MM.dd}&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;192.168.1.3_login_events-%{+YYYY.MM.dd}&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;manage_template&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;template_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;login_events&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;template_overwrite&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;protocol&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;flush_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;512&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;workers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To run Logstash we chose the quickest way, hence run it in Docker , so we have put all required Logstash configuration, logs and Maxmind databases in a directory:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;linux@linux-VM:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 linux linux 26331174 Aug   6 19:11 GeoIP2-ISP.mmdb
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 linux linux 51469823 Aug   6 19:11 GeoLite2-City.mmdb
&lt;span class=&quot;nt&quot;&gt;-rw-rw-r--&lt;/span&gt; 1 linux linux      107 Aug  13 19:13 input-geo.json
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 linux linux     2244 Aug  13 19:32 logstash.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running Logstash on Docker is relatively easy as Docker images for are available from the &lt;a href=&quot;https://www.docker.elastic.co/&quot;&gt;Elastic Docker registry&lt;/a&gt;. You can find more information &lt;a href=&quot;https://www.elastic.co/guide/en/logstash/current/docker.html&quot;&gt;here&lt;/a&gt;. Let’s run and interactive Docker container with Logstash 6.3.2:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run -it \
    --rm \
    --name logstash \
    -v $(pwd)/GeoIP2-ISP.mmdb:/usr/share/logstash/GeoIP2-ISP.mmdb \
    -v $(pwd)/GeoLite2-City.mmdb:/usr/share/logstash/GeoLite2-City.mmdb \
    -v $(pwd)/input-geo.json:/var/log/input-geo.json \
    -v $(pwd)/logstash.conf:/usr/share/logstash/pipeline/logstash.conf \
    docker.elastic.co/logstash/logstash-oss:6.3.2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While Logstash is running, if you examine Elasticsearch or &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/logstash/success-debug.txt&lt;/code&gt;, you will notice that the messages contain a lot of geolocation information and they will resemble to the following:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;63.145.248.101&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/var/log/input-geo.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;a14a2394ba12&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;@timestamp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2018-08-13T17:33:05.894Z&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;mygeo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;src_geoip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;postal_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;94804&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;country_code3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;US&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dma_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;807&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;continent_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;NA&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;region_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;California&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;longitude&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-122.3437&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;63.145.248.101&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;isp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CenturyLink&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;region_code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CA&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;latitude&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;37.9255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;as_org&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Qwest Communications Company, LLC&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;country_code2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;US&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;asn&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;209&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;location&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lon&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-122.3437&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lat&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;37.9255&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;organization&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CenturyLink&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;city_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Richmond&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;country_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;United States&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;timezone&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;America/Los_Angeles&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Christos&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;@version&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thank God we have a geolocation result! We hope this article helped you get up and running!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="logstash" /><category term="geolocation" /><category term="ip" /><category term="geoip" /><category term="maxmind" /><category term="geo" /><category term="geolite" /><category term="geolite2" /><category term="database" /><category term="json" /><category term="parse" /><category term="message" /><category term="log" /><summary type="html">Today we wanted to parse some json logs which we had in a file using Logstash and enrich them with Geolocation information regarding the city and the ISP an IP belongs. The file, (let’s call it /var/log/input-geo.json) had the following structure:</summary></entry><entry><title type="html">Creating a Beat based on Metricbeat resolving Init and create metricset failures</title><link href="https://manios.org/2018/07/23/create-a-beat-based-on-metricbeat-resolving-bugs" rel="alternate" type="text/html" title="Creating a Beat based on Metricbeat resolving Init and create metricset failures" /><published>2018-07-23T22:31:00+03:00</published><updated>2018-07-23T22:31:00+03:00</updated><id>https://manios.org/2018/07/23/create-a-beat-based-on-metricbeat-resolving-bugs</id><content type="html" xml:base="https://manios.org/2018/07/23/create-a-beat-based-on-metricbeat-resolving-bugs">&lt;p&gt;I suspect that you are reading this post after having trouble creating a new Elastic Beat based on Metricbeat. Bud do not worry! We have you covered and solved the issues for you!&lt;/p&gt;

&lt;p&gt;Long story short, a few days ago we wanted to create a new Metricbeat. After reading and executing step by step the official guide “&lt;a href=&quot;https://www.elastic.co/guide/en/beats/devguide/current/creating-beat-from-metricbeat.html&quot;&gt;Creating a Beat based on Metricbeat&lt;/a&gt;” we stumpled upon a series of issues like &lt;a href=&quot;https://discuss.elastic.co/t/step-3-init-and-create-the-metricset-failure/112046/12&quot;&gt;Step 3 - Init and create the metricset failure&lt;/a&gt;. After spending 2 days trying to resolve our local dependencies and solve the issues in our development environment, we decided to make everything in a sterilized environment, hence a Docker container.&lt;/p&gt;

&lt;p&gt;To begin with, we used Go language &lt;a href=&quot;https://hub.docker.com/_/golang/&quot;&gt;official Docker image&lt;/a&gt; with tag &lt;code class=&quot;highlighter-rouge&quot;&gt;golang:1.10.2-stretch&lt;/code&gt; and we run everything in it. So in a shell, we executed:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run -it --rm --name go1.10 golang:1.10.2-stretch /bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When the container is started, a new shell is loaded and we can download all the dependencies needed, by executing inside it:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;apt-get update &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; wget curl git vim &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;set number&quot;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;tee&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; /etc/vim/vimrc &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;syntax on&quot;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;tee&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; /etc/vim/vimrc &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;colorscheme evening&quot;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;tee&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; /etc/vim/vimrc  &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; wget https://bootstrap.pypa.io/get-pip.py &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; python get-pip.py &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rm &lt;/span&gt;get-pip.py &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pip &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;virtualenv &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Our environment:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;===================================&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; go version &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Python version: &quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; python &lt;span class=&quot;nt&quot;&gt;--version&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;virtualenv version: &quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; virtualenv &lt;span class=&quot;nt&quot;&gt;--version&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;===================================&quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Fetching metricbeat source code: &quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; go get github.com/elastic/beats/metricbeat &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[OK]&quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GOPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/src/github.com/elastic/beats &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Checking out commit 2619e137c1f7eb031fc89132045117a85c7ef818 to new branch in order to avoid bug&quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; git checkout &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; working 2619e137c1f7eb031fc89132045117a85c7ef818 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$GOPATH&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'s/@-cp -r module\/[*]\/_meta\/kibana _meta\//@-cp -r ${GOPATH}\/src\/github.com\/elastic\/beats\/metricbeat\/module\/*\/_meta\/kibana _meta\//'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GOPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/src/github.com/elastic/beats/metricbeat/Makefile &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Elastic beats environment has been initialised successfully! You can now generate a new Metricbeat!&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If everything works as expected you should see something like this in the output:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Our environment:
===================================
go version go1.10.2 linux/amd64
Python version: Python 2.7.13
virtualenv version: 16.0.0
===================================
Fetching metricbeat source code: [OK]
Checking out commit 2619e137c1f7eb031fc89132045117a85c7ef818 to new branch in order to avoid bug
Switched to a new branch 'working'
Elastic beats environment has been initialised successfully! You can now generate a new Metricbeat!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The environment is set up correctly. Let’s create a new Metricbeat. So execute:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;python ${GOPATH}/src/github.com/elastic/beats/script/generate.py --type=metricbeat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and respond to the input as the example:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@1e407b4d73a7:/go# python ${GOPATH}/src/github.com/elastic/beats/script/generate.py --type=metricbeat
Beat Name [Examplebeat]: weatherbeat
Your Github Name [your-github-name]: manios
Beat Path [github.com/manios/weatherbeat]:
Firstname Lastname: Christos Manios
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The newly created Metricbeat will be stored in &lt;code class=&quot;highlighter-rouge&quot;&gt;${GOPATH}/src/github.com/manios/weatherbeat/&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Navigate to the Metricbeat directory. Execute the following to avoid weird errors when creating a metricset:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GOPATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/src/github.com/manios/weatherbeat &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$GOPATH&lt;/span&gt;/src/github.com/elastic/beats/metricbeat/scripts &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now we are ready to create a new Metricset. The metricset module will be called &lt;code class=&quot;highlighter-rouge&quot;&gt;skgtemperatures&lt;/code&gt; and the metricset itself &lt;code class=&quot;highlighter-rouge&quot;&gt;hydro&lt;/code&gt;. According to the official guide we execute &lt;code class=&quot;highlighter-rouge&quot;&gt;make setup&lt;/code&gt; and the output will be the following:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mkdir -p vendor/github.com/elastic/
cp -R /go/src/github.com/elastic/beats vendor/github.com/elastic/
rm -rf vendor/github.com/elastic/beats/.git
make create-metricset
make[1]: Entering directory '/go/src/github.com/manios/weatherbeat'
New python executable in /go/src/github.com/manios/weatherbeat/build/python-env/bin/python
Installing setuptools, pip, wheel...done.
docker-compose 1.22.0 has requirement requests!=2.11.0,!=2.12.2,!=2.18.0,&amp;lt;2.19,&amp;gt;=2.6.1, but you'll have requests 2.19.1 which is incompatible.
# Work around pip bug. See: https://github.com/pypa/pip/issues/4464
find /go/src/github.com/manios/weatherbeat/build/python-env -type d -name 'dist-packages' -exec sh -c &quot;echo dist-packages &amp;gt; {}.pth&quot; ';'
Module name: skgtemperature
Metricset name: hydro
Module skgtemperature created.
Metricset hydro created.
make[1]: Leaving directory '/go/src/github.com/manios/weatherbeat'
make collect
make[1]: Entering directory '/go/src/github.com/manios/weatherbeat'
# Work around pip bug. See: https://github.com/pypa/pip/issues/4464
find /go/src/github.com/manios/weatherbeat/build/python-env -type d -name 'dist-packages' -exec sh -c &quot;echo dist-packages &amp;gt; {}.pth&quot; ';'
make[1]: Leaving directory '/go/src/github.com/manios/weatherbeat'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If everything works as expected then if you execute a &lt;code class=&quot;highlighter-rouge&quot;&gt;tree&lt;/code&gt; command, to &lt;code class=&quot;highlighter-rouge&quot;&gt;module&lt;/code&gt; directory you will probably have the following structure:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-- skgtemperature
    |-- _meta
    |   |-- config.yml
    |   |-- docs.asciidoc
    |   `-- fields.yml
    |-- doc.go
    `-- hydro
        |-- _meta
        |   |-- data.json
        |   |-- docs.asciidoc
        |   `-- fields.yml
        `-- hydro.go
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That’s it! I hope it helps!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="elastic" /><category term="metricbeat" /><category term="beats" /><category term="elasticsearch" /><category term="create" /><category term="generator" /><category term="go" /><category term="golang" /><category term="elk" /><category term="search" /><category term="kibana" /><category term="index" /><category term="monitor" /><summary type="html">I suspect that you are reading this post after having trouble creating a new Elastic Beat based on Metricbeat. Bud do not worry! We have you covered and solved the issues for you!</summary></entry><entry><title type="html">Git merge conflicts using Tortoise Git merge in Windows</title><link href="https://manios.org/2018/05/30/git-merge-conflicts-using-tortoise-git-merge-windows" rel="alternate" type="text/html" title="Git merge conflicts using Tortoise Git merge in Windows" /><published>2018-05-30T20:42:00+03:00</published><updated>2018-05-30T20:42:00+03:00</updated><id>https://manios.org/2018/05/30/git-merge-conflicts-using-tortoise-git-merge-windows</id><content type="html" xml:base="https://manios.org/2018/05/30/git-merge-conflicts-using-tortoise-git-merge-windows">&lt;p&gt;Today we wanted to use Tortoise Git Merge, a Windows Git utility which comes with &lt;a href=&quot;https://tortoisegit.org&quot;&gt;Tortoise Git&lt;/a&gt;. It helps us do a 3 way merge and solve our conflicts easily. The advantage of it is that it automatically merges the lines that where uniquely modified in every file and you only need to merge the common changes where the conflicts are. So in our case we had a file , let’s call it &lt;code class=&quot;highlighter-rouge&quot;&gt;README.md&lt;/code&gt;, in which we had 1000 changed lines out of which only 2 had a conflict with the file pulled from upstream server. Eclipse and IntelliJ do provide a merge editor but as far as we are concerned they are not automatically merging your unique changes (please correct us if we are wrong). After some searching on the web of how to do so, we found &lt;a href=&quot;https://stackoverflow.com/questions/5190188/why-cant-i-use-tortoisemerge-as-my-git-merge-tool-on-windows/19711169#19711169&quot;&gt;StackOverflow Question 5190188 : Why can’t I use TortoiseMerge as my git merge tool on Windows?&lt;/a&gt; which explains different approaches.&lt;/p&gt;

&lt;p&gt;So according to the aforementioned question and our experiments, in order to use Tortoise Git Merge you have to download and install &lt;a href=&quot;https://tortoisegit.org&quot;&gt;Tortoise Git&lt;/a&gt; and configure your local &lt;code class=&quot;highlighter-rouge&quot;&gt;.gitconfig&lt;/code&gt; file with the following lines:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[core]
	longpaths = true
	autocrlf = true
[merge]
	tool=tortoisemerge
[mergetool &quot;tortoisemerge&quot;]
	cmd = \&quot;C:\\Program Files\\TortoiseGit\\bin\\TortoiseGitMerge.exe\&quot; -base:\&quot;$BASE\&quot; -theirs:\&quot;$LOCAL\&quot; -mine:\&quot;$REMOTE\&quot; -merged:\&quot;$MERGED\&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you want an one liner equivalent command, you can run the following:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git config --global mergetool.tortoisemerge.cmd &quot;\&quot;C:\\Program Files\\TortoiseGit\\bin\\TortoiseGitMerge.exe\&quot; -base:\&quot;$BASE\&quot; -theirs:\&quot;$LOCAL\&quot; -mine:\&quot;$REMOTE\&quot; -merged:\&quot;$MERGED\&quot;&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;NOTE:
The &lt;code class=&quot;highlighter-rouge&quot;&gt;core&lt;/code&gt; section is complimentary for Windows in order to help Git use long paths and overcome Windows 260 character &lt;a href=&quot;https://msdn.microsoft.com/en-us/library/windows/desktop/aa365247(v=vs.85).aspx&quot;&gt;MAX_PATH&lt;/a&gt; limitation. Furthermore we need to automatically checkout with file ending using &lt;code class=&quot;highlighter-rouge&quot;&gt;CRLF&lt;/code&gt; and push to &lt;code class=&quot;highlighter-rouge&quot;&gt;LF&lt;/code&gt;, thus the &lt;code class=&quot;highlighter-rouge&quot;&gt;autocrlf&lt;/code&gt; is set to &lt;code class=&quot;highlighter-rouge&quot;&gt;true&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;After this short parenthesis, back in action! When you pull from a remote repository, or you merge, or rebase a branch and Git complains about conflicts you can use in your shell or in &lt;a href=&quot;https://gitforwindows.org/&quot;&gt;Git Bash&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git mergetool
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Tortoise merge will appear with a display like the following:&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/images/2018-05-30-git-merge-with-tortoise-git/tortoiseMerge3WayMerge.png&quot;&gt;&lt;img src=&quot;/images/2018-05-30-git-merge-with-tortoise-git/tortoiseMerge3WayMerge.png&quot; alt=&quot;Tortoise merge open to merge conflicts&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;p&gt;In this image, conflicts are marked with red and the automatically merged lines are marked with yellow. Left side (Theirs) is the version of the file which comes from repository and right side (Mine) is your local version with your changes.&lt;/p&gt;

&lt;p&gt;That’s it. We hope this quick guide helped you!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="git" /><category term="merge" /><category term="mergetool" /><category term="tortoise" /><category term="conflict" /><category term="windows" /><category term="client" /><summary type="html">Today we wanted to use Tortoise Git Merge, a Windows Git utility which comes with Tortoise Git. It helps us do a 3 way merge and solve our conflicts easily. The advantage of it is that it automatically merges the lines that where uniquely modified in every file and you only need to merge the common changes where the conflicts are. So in our case we had a file , let’s call it README.md, in which we had 1000 changed lines out of which only 2 had a conflict with the file pulled from upstream server. Eclipse and IntelliJ do provide a merge editor but as far as we are concerned they are not automatically merging your unique changes (please correct us if we are wrong). After some searching on the web of how to do so, we found StackOverflow Question 5190188 : Why can’t I use TortoiseMerge as my git merge tool on Windows? which explains different approaches.</summary></entry><entry><title type="html">Debug HTTP request of Java SOAP JAX-WS web service client</title><link href="https://manios.org/2018/04/03/java-soap-service-client-debug-http-message" rel="alternate" type="text/html" title="Debug HTTP request of Java SOAP JAX-WS web service client" /><published>2018-04-03T19:42:00+03:00</published><updated>2018-04-03T19:42:00+03:00</updated><id>https://manios.org/2018/04/03/java-soap-service-client-debug-http-message</id><content type="html" xml:base="https://manios.org/2018/04/03/java-soap-service-client-debug-http-message">&lt;p&gt;Today I wanted to debug in Java a JAX-WS SOAP web service client and see the exact message that is send as an &lt;a href=&quot;https://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html&quot;&gt;HTTP request&lt;/a&gt;. So after searching, I found in this   &lt;a href=&quot;https://stackoverflow.com/questions/1945618/tracing-xml-request-responses-with-jax-ws&quot;&gt;StackOverflow question&lt;/a&gt; that if we insert the following lines before calling the service:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setProperty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;com.sun.xml.ws.transport.http.client.HttpTransportPipe.dump&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setProperty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;com.sun.xml.internal.ws.transport.http.client.HttpTransportPipe.dump&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setProperty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;com.sun.xml.ws.transport.http.HttpAdapter.dump&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setProperty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;com.sun.xml.internal.ws.transport.http.HttpAdapter.dump&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;when we call the service it will produce the following output in logs (or console output):&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-txt&quot;&gt;---[HTTP request - http://localhost:9090/ContactRequestServicePort]---
Accept: text/xml, multipart/related
Content-Type: text/xml; charset=utf-8
SOAPAction: &quot;newContact&quot;
User-Agent: JAX-WS RI 2.2.9-b130926.1035 svn-revision#5f6196f2b90e9460065a4c2f4e30e065b245e51e
&amp;lt;?xml version=&quot;1.0&quot; ?&amp;gt;&amp;lt;S:Envelope xmlns:S=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&amp;gt;&amp;lt;S:Body&amp;gt;&amp;lt;ns2:newContact xmlns:ns4=&quot;http://www.acmecorp.com/contacts/Exception&quot; xmlns:ns3=&quot;http://www.acmecorp.com/contacts/RequestMetaInfo&quot; xmlns:ns2=&quot;http://www.acmecorp.com/contacts/crm-contact/Service&quot;&amp;gt;&amp;lt;ns2:contact&amp;gt;&amp;lt;ns2:prefix&amp;gt;Mr&amp;lt;/ns2:prefix&amp;gt;&amp;lt;ns2:name&amp;gt;John&amp;lt;/ns2:name&amp;gt;&amp;lt;ns2:surname&amp;gt;Longjohn&amp;lt;/ns2:surname&amp;gt;&amp;lt;/ns2:contact&amp;gt;&amp;lt;/ns2:newContact&amp;gt;&amp;lt;/S:Body&amp;gt;&amp;lt;/S:Envelope&amp;gt;--------------------
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;It works! Now we have the entire HTTP request and we can pretty print the XML which is included in the message body of HTTP request to see what we send to the web service:&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; ?&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;S:Envelope&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:S=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;S:Body&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;ns2:newContact&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:ns4=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.acmecorp.com/contacts/Exception&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:ns3=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.acmecorp.com/contacts/RequestMetaInfo&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:ns2=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.acmecorp.com/contacts/crm-contact/Service&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;ns2:contact&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;nt&quot;&gt;&amp;lt;ns2:prefix&amp;gt;&lt;/span&gt;Mr&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ns2:prefix&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;nt&quot;&gt;&amp;lt;ns2:name&amp;gt;&lt;/span&gt;John&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ns2:name&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;nt&quot;&gt;&amp;lt;ns2:surname&amp;gt;&lt;/span&gt;Longjohn&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ns2:surname&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;/ns2:contact&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/ns2:newContact&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/S:Body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/S:Envelope&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>cmanios</name></author><category term="java" /><category term="http" /><category term="request" /><category term="message" /><category term="debug" /><category term="soap" /><category term="client" /><category term="jax" /><category term="ws" /><category term="jax-ws" /><category term="web" /><category term="service" /><category term="print" /><category term="log" /><category term="console" /><category term="wsdl" /><summary type="html">Today I wanted to debug in Java a JAX-WS SOAP web service client and see the exact message that is send as an HTTP request. So after searching, I found in this StackOverflow question that if we insert the following lines before calling the service:</summary></entry><entry><title type="html">HTTP Basic Authentication in Java SOAP JAX-WS web service client</title><link href="https://manios.org/2018/03/30/java-soap-jax-ws-client-basic-auth" rel="alternate" type="text/html" title="HTTP Basic Authentication in Java SOAP JAX-WS web service client" /><published>2018-03-30T17:42:00+03:00</published><updated>2018-03-30T17:42:00+03:00</updated><id>https://manios.org/2018/03/30/java-soap-jax-ws-client-basic-auth</id><content type="html" xml:base="https://manios.org/2018/03/30/java-soap-jax-ws-client-basic-auth">&lt;p&gt;Today I had to create a Java client for a SOAP web service. So I opened &lt;a href=&quot;http://netbeans.org/&quot;&gt;Netbeans&lt;/a&gt; IDE and used the great tool which generates JAX-WS client code using the respective service &lt;code class=&quot;highlighter-rouge&quot;&gt;.wsdl&lt;/code&gt; file. However, the service needed to be called using &lt;a href=&quot;https://en.wikipedia.org/wiki/Basic_access_authentication&quot;&gt;Basic Http Authentication&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt;: The solution provided works if the WSDL is not protected itself by Basic Http Authentication. The Basic Authentication &lt;u&gt;is added as a header in the HTTP request&lt;/u&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;After a lot of searching I found that (StackOverflow question) this is possible:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;ContactCreationRequestService_Service&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;srv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ContactCreationRequestService_Service&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ContactCreationRequestService&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;porta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Get service port&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;porta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;srv&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getContactCreationRequestServicePort&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Add username and password for Basic Authentication&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reqContext&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BindingProvider&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;porta&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getRequestContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;reqContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BindingProvider&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;USERNAME_PROPERTY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;reqContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BindingProvider&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;PASSWORD_PROPERTY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Create a contact request&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ContactRequest&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ka&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ContactRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ka&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setPrefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Mr&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ka&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Christos&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ka&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setSurname&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Manios&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;NewContact&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nka&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NewContact&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;nka&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setContactRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ka&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Call the web service&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;porta&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;newContactCreationRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nka&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SoapServiceException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we enable debugging to see the actual HTTP request, then the logs will show output like the following:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---[HTTP request - http://localhost:9090/ContactRequestServicePort]---
Accept: text/xml, multipart/related
Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=
Content-Type: text/xml; charset=utf-8
SOAPAction: &quot;newContact&quot;
User-Agent: JAX-WS RI 2.2.9-b130926.1035 svn-revision#5f6196f2b90e9460065a4c2f4e30e065b245e51e
&amp;lt;?xml version=&quot;1.0&quot; ?&amp;gt;&amp;lt;S:Envelope xmlns:S=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&amp;gt;&amp;lt;S:Body&amp;gt;&amp;lt;ns2:newContact xmlns:ns4=&quot;http://www.acmecorp.com/contacts/Exception&quot; xmlns:ns3=&quot;http://www.acmecorp.com/contacts/RequestMetaInfo&quot; xmlns:ns2=&quot;http://www.acmecorp.com/contacts/crm-contact/Service&quot;&amp;gt;&amp;lt;ns2:contact&amp;gt;&amp;lt;ns2:prefix&amp;gt;Mr&amp;lt;/ns2:prefix&amp;gt;&amp;lt;ns2:name&amp;gt;John&amp;lt;/ns2:name&amp;gt;&amp;lt;ns2:surname&amp;gt;Longjohn&amp;lt;/ns2:surname&amp;gt;&amp;lt;/ns2:contact&amp;gt;&amp;lt;/ns2:newContact&amp;gt;&amp;lt;/S:Body&amp;gt;&amp;lt;/S:Envelope&amp;gt;--------------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can observe that the request contains the &lt;code class=&quot;highlighter-rouge&quot;&gt;Authorization&lt;/code&gt; header as expected:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>cmanios</name></author><category term="java" /><category term="soap" /><category term="basic" /><category term="auth" /><category term="authentication" /><category term="client" /><category term="jax" /><category term="ws" /><category term="jax-ws" /><category term="web" /><category term="service" /><category term="http" /><category term="netbeans" /><category term="wsdl" /><summary type="html">Today I had to create a Java client for a SOAP web service. So I opened Netbeans IDE and used the great tool which generates JAX-WS client code using the respective service .wsdl file. However, the service needed to be called using Basic Http Authentication.</summary></entry><entry><title type="html">Install, configure and troubleshoot NTP servers in Debian Linux</title><link href="https://manios.org/2017/12/14/install-and-configure-and-troubleshoot-ntp-servers-in-debian-linux" rel="alternate" type="text/html" title="Install, configure and troubleshoot NTP servers in Debian Linux" /><published>2017-12-14T10:42:00+02:00</published><updated>2017-12-14T10:42:00+02:00</updated><id>https://manios.org/2017/12/14/install-and-configure-and-troubleshoot-ntp-servers-in-debian-linux</id><content type="html" xml:base="https://manios.org/2017/12/14/install-and-configure-and-troubleshoot-ntp-servers-in-debian-linux">&lt;p&gt;If you are reading this article, perhaps you have searched a lot about NTP server installation in Linux, issues and problems encountered and how to troubleshoot them! We know that there are so many articles about how to configure NTP servers but we could not find any which contains all the issues we faced in the same place!&lt;/p&gt;

&lt;h2 id=&quot;our-story&quot;&gt;Our story&lt;/h2&gt;

&lt;p&gt;A client of ours has a sever infrastructure where from the 40+ VMs in the tenant environment, only 3 are allowed to communicate with external NTP servers. Thus we had to install NTP servers in 3 Linux virtual machines in order to synchronise their clocks with the external pools and in the meantime act as internal environment  primary NTP servers. The following diagram (kudos to &lt;a href=&quot;http://asciiflow.com/&quot;&gt;AsciiFlow&lt;/a&gt;) summarizes the installation:&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;                  +---------------------+
                  |     External NTP    |
                  |1.europe.pool.ntp.org|
                  +----------+----------+
                             ^
                             |
                             |
        +---------------------------------------+
        |                    |                  |
        |                    |                  |
+-------+--------+  +--------+-------+  +-------+--------+
|      VM1       |  |      VM2       |  |      VM3       |
|  192.168.10.1  |  |  192.168.10.2  |  |  192.168.10.3  |
|    NTP srv1    |  |    NTP srv2    |  |    NTP srv3    |
+-------+--------+  +--------+-------+  +-----+----------+
        ^                    ^                ^
        |                    |                |
        +-------------------------------------+
                             |
                     +-------+--------+
                     |      VM4 (any) |
                     |  192.168.10.4  |
                     |   NTP client   |
                     +----------------+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notes on diagram:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;External NTP&lt;/code&gt; is one of the many &lt;a href=&quot;http://www.pool.ntp.org&quot;&gt;NTP pools&lt;/a&gt; in the internet.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;VM1&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;VM2&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;VM3&lt;/code&gt; are the Linux virtual machines which are allowed to connect to the internet using port 123 and synchronise their clocks with the external pool.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;VM4&lt;/code&gt; is any virtual machine (Linux or Windows) in the infrastructure which cannot communicate with external NTP servers, thus it will use VM1, VM2 and VM3 to update its clock.&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;IMPORTANT NOTES&lt;/strong&gt;:&lt;/p&gt;
  &lt;ol&gt;
    &lt;li&gt;If you are a developer or a devops person and you have to communicate with network admins for any network issues you might encounter, please be meticulous and describe the problems in detail.&lt;/li&gt;
    &lt;li&gt;During this operation (yes, debugging was like war!), the majority of our problems were network related so we had to debug every step and inform network administrators in order to configure firewalls.&lt;/li&gt;
    &lt;li&gt;If your infrastructure is completely blocked by a firewall and you cannot access UDP port 123 (ntp) in any way, then you might consider using &lt;a href=&quot;https://linux.die.net/man/8/htpdate&quot;&gt;htpdate&lt;/a&gt; in VM1, VM2, VM3.&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;install-ntp-server-in-debian-linux&quot;&gt;Install NTP Server in Debian Linux&lt;/h2&gt;

&lt;p&gt;So, to install NTP server in Debian Linux, you just execute:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;ntp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in VM1, VM2, VM3 and VM4 . After it is installed, our efforts are focused on one single file: &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/ntp.conf&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;configure-ntp-server&quot;&gt;Configure NTP Server&lt;/h2&gt;

&lt;p&gt;As we mentioned, we open &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/ntp.conf&lt;/code&gt; and edit the pools in VM1, VM2, VM3 according to our needs:&lt;/p&gt;

&lt;div class=&quot;language-conf highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# /etc/ntp.conf, configuration for ntpd; see ntp.conf(5) for help
&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;driftfile&lt;/span&gt; /&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;lib&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;ntp&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;ntp&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;drift&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Enable this if you want statistics to be logged.
#statsdir /var/log/ntpstats/
&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;statistics&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loopstats&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;peerstats&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clockstats&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;filegen&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loopstats&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loopstats&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;day&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;enable&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;filegen&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;peerstats&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;peerstats&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;day&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;enable&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;filegen&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clockstats&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clockstats&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;day&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;enable&lt;/span&gt;


&lt;span class=&quot;c&quot;&gt;# You do need to talk to an NTP server or two (or three).
#server ntp.your-provider.example
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# pool.ntp.org maps to about 1000 low-stratum NTP servers.  Your server will
# pick a different set every time it starts up.  Please consider joining the
# pool: &amp;lt;http://www.pool.ntp.org/join.html&amp;gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;gr&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;ntp&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;org&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;iburst&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;minpoll&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxpoll&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;europe&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;ntp&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;org&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;iburst&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;minpoll&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxpoll&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;europe&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;ntp&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;org&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;iburst&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;minpoll&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxpoll&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Undisciplined Local Clock. This is a fake driver intended for backup
# and when no outside source of synchronized time is available. 
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;  &lt;span class=&quot;m&quot;&gt;127&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;127&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;# local clock
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fudge&lt;/span&gt;   &lt;span class=&quot;m&quot;&gt;127&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;127&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stratum&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Access control configuration; see /usr/share/doc/ntp-doc/html/accopt.html for
# details.  The web page &amp;lt;http://support.ntp.org/bin/view/Support/AccessRestrictions&amp;gt;
# might also be helpful.
#
# Note that &quot;restrict&quot; applies to both servers and clients, so a configuration
# that might be intended to block requests from certain clients could also end
# up blocking replies from your own upstream servers.
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# By default, exchange time with everybody, but don't allow configuration.
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;restrict&lt;/span&gt; -&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kod&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;notrap&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nomodify&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nopeer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;noquery&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;limited&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;restrict&lt;/span&gt; -&lt;span class=&quot;m&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kod&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;notrap&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nomodify&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nopeer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;noquery&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;limited&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Local users may interrogate the ntp server more closely.
#restrict 127.0.0.1
#restrict ::1
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Needed for adding pool entries
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;restrict&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;notrap&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nomodify&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;noquery&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Clients from this (example!) subnet have unlimited access, but only if
# cryptographically authenticated.
#restrict 192.168.123.0 mask 255.255.255.0 notrust
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# If you want to provide time to your local subnet, change the next line.
# (Again, the address is an example only.)
#broadcast 192.168.123.255
&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# If you want to listen to time broadcasts on your local subnet, de-comment the
# next lines.  Please do this only if you trust everybody on the network!
#disable auth
#broadcastclient
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTES&lt;/strong&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;We have put &lt;code class=&quot;highlighter-rouge&quot;&gt;minpoll&lt;/code&gt; to 6 (2^6 = 64 sec) and &lt;code class=&quot;highlighter-rouge&quot;&gt;maxpoll&lt;/code&gt; to 8 (2^8 = 256 sec) as we noticed that our local NTP servers tended to drift for minutes. Sometimes, +4 minutes in a day! You can find more information about &lt;code class=&quot;highlighter-rouge&quot;&gt;minpoll&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;maxpoll&lt;/code&gt; &lt;a href=&quot;https://access.redhat.com/solutions/625863&quot;&gt;here&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The following lines:&lt;/p&gt;

    &lt;div class=&quot;language-conf highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;   &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;  &lt;span class=&quot;m&quot;&gt;127&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;127&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;# local clock
&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;fudge&lt;/span&gt;   &lt;span class=&quot;m&quot;&gt;127&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;127&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stratum&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;are used  in order to instruct the local server to act as a low stratum server and be preferred from the local clients. (more information : &lt;a href=&quot;http://en.linuxreviews.org/NTP_-_Howto_make_the_clock_show_the_correct_time&quot;&gt;here&lt;/a&gt;)&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;configure-linux-ntp-client&quot;&gt;Configure Linux NTP Client&lt;/h2&gt;

&lt;p&gt;We edit &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/ntp.conf&lt;/code&gt; of VM4 and replace any external pools with our local NTP servers (VM1, VM2, VM3). Your configuration might look like the following:&lt;/p&gt;

&lt;div class=&quot;language-conf highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# pool.ntp.org maps to about 1000 low-stratum NTP servers.  Your server will
# pick a different set every time it starts up.  Please consider joining the
# pool: &amp;lt;http://www.pool.ntp.org/join.html&amp;gt;
#pool 0.debian.pool.ntp.org iburst
#pool 1.debian.pool.ntp.org iburst
#pool 2.debian.pool.ntp.org iburst
#pool 3.debian.pool.ntp.org iburst
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;192&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;168&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;iburst&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;minpoll&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxpoll&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;192&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;168&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;iburst&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;minpoll&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxpoll&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;192&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;168&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;.&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;iburst&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;minpoll&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxpoll&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Again as you can you may notice we have put &lt;code class=&quot;highlighter-rouge&quot;&gt;minpoll&lt;/code&gt; to 6 (2^6 = 64 sec) and &lt;code class=&quot;highlighter-rouge&quot;&gt;maxpoll&lt;/code&gt; to 8 (2^8 = 256 sec) as we noticed that our local NTP servers tended to drift for minutes. Sometimes, +4 minutes in a day! You can find more information about &lt;code class=&quot;highlighter-rouge&quot;&gt;minpoll&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;maxpoll&lt;/code&gt; &lt;a href=&quot;https://access.redhat.com/solutions/625863&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;configure-windows-ntp-client&quot;&gt;Configure Windows NTP Client&lt;/h2&gt;

&lt;p&gt;Our virtual machines use Windows Server 2012 R2 (for Windows 2003 and older see &lt;a href=&quot;http://www.pool.ntp.org/en/use.html&quot;&gt;here&lt;/a&gt;). We followed the instructions from &lt;a href=&quot;http://www.pool.ntp.org/en/use.html&quot;&gt;pool.ntp.org&lt;/a&gt; and &lt;a href=&quot;https://serverfault.com/questions/294787/how-do-i-force-sync-the-time-on-windows-workstation-or-server&quot;&gt;this&lt;/a&gt; article. So we open a windows command line prompt with administrative privileges (WinKey + R + type “cmd” + hit enter key) and run :&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;w32tm /config /syncfromflags:manual /manualpeerlist:&lt;span class=&quot;s2&quot;&gt;&quot;192.168.10.1 192.168.10.2 192.168.10.3&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and then restart the time service so changes take effect and force it to resync:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;net stop W32Time
net start W32Time
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;troubleshooting&quot;&gt;Troubleshooting&lt;/h2&gt;

&lt;p&gt;This is going to be the longest of all sections! Yes! Debugging was hard, we dare say! For our debugging purposes in Linux VMs we used &lt;code class=&quot;highlighter-rouge&quot;&gt;ntpdate&lt;/code&gt; tool at first, although is &lt;a href=&quot;https://support.ntp.org/bin/view/Dev/DeprecatingNtpdate&quot;&gt;deprecated&lt;/a&gt;. Also we have used &lt;code class=&quot;highlighter-rouge&quot;&gt;ntpq&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt;. So this is what you have to do if you encounter the following errors both in your local NTP servers and clients.&lt;/p&gt;

&lt;h3 id=&quot;ntp-server-dropped-strata-too-high&quot;&gt;NTP Server dropped: strata too high&lt;/h3&gt;

&lt;p&gt;If you see in &lt;code class=&quot;highlighter-rouge&quot;&gt;syslog&lt;/code&gt; or in the output of the command:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;ntpdate &lt;span class=&quot;nt&quot;&gt;-dv&lt;/span&gt; 2.europe.pool.ntp.org
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the error:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;91.228.108.200: Server dropped: strata too high
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then, acccording to &lt;a href=&quot;http://www.markelov.org/wiki/index.php?title=NTP._Server_dropped:_strata_too_high&quot;&gt;this&lt;/a&gt; and &lt;a href=&quot;http://www.tuxradar.com/answers/547&quot;&gt;this&lt;/a&gt; article, the server is too far out of sync with the upstream servers, so it sets an artificially high stratum value to prevent other computers trusting it.&lt;/p&gt;

&lt;p&gt;A possible solution is to set the time in the server manually as described &lt;a href=&quot;https://www.cyberciti.biz/faq/howto-set-date-time-from-linux-command-prompt/&quot;&gt;here&lt;/a&gt; and then restart &lt;code class=&quot;highlighter-rouge&quot;&gt;ntp&lt;/code&gt; service to see what happens.&lt;/p&gt;

&lt;h3 id=&quot;no-server-suitable-for-synchronization-found&quot;&gt;No server suitable for synchronization found&lt;/h3&gt;

&lt;p&gt;If you use &lt;code class=&quot;highlighter-rouge&quot;&gt;ntpdate&lt;/code&gt; to debug like this:&lt;/p&gt;

&lt;p class=&quot;notice--warning&quot;&gt;&lt;strong&gt;WARNING!&lt;/strong&gt; NTP service has to be stopped in order to perform the following test.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;ntpdate &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-B&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; 3.gr.pool.ntp.org
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the output in syslog is like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bobos@WEBSRV01:~$ sudo tail -f -n 10 /var/log/syslog
Nov 24 13:33:39 WEBWEBSRV01 ntpdate[26635]: ntpdate 4.2.8p10@1.3728-o Sat Nov 24 19:02:40 UTC 2017 (1)
Nov 24 13:33:48 WEBSRV01 ntpdate[26635]: no server suitable for synchronization found
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then it might a network issue. To be sure, run &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; :&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bobos@WEBSRV01:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-p123&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sU&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-P0&lt;/span&gt; 3.gr.pool.ntp.org
Starting Nmap 7.40 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2017-11-24 13:43 EEST
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;3.gr.pool.ntp.org &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;194.177.210.54&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00011s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Other addresses &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;3.gr.pool.ntp.org &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;not scanned&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: ::1
PORT    STATE  SERVICE
123/udp closed ntp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see UTDP port 123 is closed, so we cannot communicate. Let’s run a second test:&lt;/p&gt;

&lt;p class=&quot;notice--warning&quot;&gt;&lt;strong&gt;WARNING!&lt;/strong&gt; NTP service has to be stopped in order to perform the following test.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bobos@WEBSRV01:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;ntpdate &lt;span class=&quot;nt&quot;&gt;-dv&lt;/span&gt; 2.europe.pool.ntp.org
24 Oct 12:02:20 ntpdate[26399]: ntpdate 4.2.8p10@1.3728-o Sat Sep 23 19:02:40 UTC 2017 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;87.118.124.35&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91.228.108.200&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;194.177.4.1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;81.16.38.161&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;87.118.124.35&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91.228.108.200&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;194.177.4.1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;81.16.38.161&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;87.118.124.35&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91.228.108.200&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;194.177.4.1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;81.16.38.161&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;87.118.124.35&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91.228.108.200&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;194.177.4.1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;81.16.38.161&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;87.118.124.35&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91.228.108.200&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;194.177.4.1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
transmit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;81.16.38.161&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
87.118.124.35: Server dropped: no data
91.228.108.200: Server dropped: no data
194.177.4.1: Server dropped: no data
81.16.38.161: Server dropped: no data
server 87.118.124.35, port 123
stratum 0, precision 0, leap 00, trust 000
refid &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;87.118.124.35], delay 0.00000, dispersion 64.00000
transmitted 4, &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;filter 4
reference &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;:    00000000.00000000  Thu, Feb  7 2036  8:28:16.000
originate timestamp: 00000000.00000000  Thu, Feb  7 2036  8:28:16.000
transmit timestamp:  dd998022.d88eee1a  Tue, Oct 24 2017 12:02:26.845
filter delay:  0.00000  0.00000  0.00000  0.00000 
         0.00000  0.00000  0.00000  0.00000 
filter offset: 0.000000 0.000000 0.000000 0.000000
         0.000000 0.000000 0.000000 0.000000
delay 0.00000, dispersion 64.00000
offset 0.000000

server 91.228.108.200, port 123
stratum 0, precision 0, leap 00, trust 000
refid &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;91.228.108.200], delay 0.00000, dispersion 64.00000
transmitted 4, &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;filter 4
reference &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;:    00000000.00000000  Thu, Feb  7 2036  8:28:16.000
originate timestamp: 00000000.00000000  Thu, Feb  7 2036  8:28:16.000
transmit timestamp:  dd998023.0bc09a0a  Tue, Oct 24 2017 12:02:27.045
filter delay:  0.00000  0.00000  0.00000  0.00000 
         0.00000  0.00000  0.00000  0.00000 
filter offset: 0.000000 0.000000 0.000000 0.000000
         0.000000 0.000000 0.000000 0.000000
delay 0.00000, dispersion 64.00000
offset 0.000000

server 194.177.4.1, port 123
stratum 0, precision 0, leap 00, trust 000
refid &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;194.177.4.1], delay 0.00000, dispersion 64.00000
transmitted 4, &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;filter 4
reference &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;:    00000000.00000000  Thu, Feb  7 2036  8:28:16.000
originate timestamp: 00000000.00000000  Thu, Feb  7 2036  8:28:16.000
transmit timestamp:  dd998023.3ef4248c  Tue, Oct 24 2017 12:02:27.245
filter delay:  0.00000  0.00000  0.00000  0.00000 
         0.00000  0.00000  0.00000  0.00000 
filter offset: 0.000000 0.000000 0.000000 0.000000
         0.000000 0.000000 0.000000 0.000000
delay 0.00000, dispersion 64.00000
offset 0.000000

server 81.16.38.161, port 123
stratum 0, precision 0, leap 00, trust 000
refid &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;81.16.38.161], delay 0.00000, dispersion 64.00000
transmitted 4, &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;filter 4
reference &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;:    00000000.00000000  Thu, Feb  7 2036  8:28:16.000
originate timestamp: 00000000.00000000  Thu, Feb  7 2036  8:28:16.000
transmit timestamp:  dd998023.72276991  Tue, Oct 24 2017 12:02:27.445
filter delay:  0.00000  0.00000  0.00000  0.00000 
         0.00000  0.00000  0.00000  0.00000 
filter offset: 0.000000 0.000000 0.000000 0.000000
         0.000000 0.000000 0.000000 0.000000
delay 0.00000, dispersion 64.00000
offset 0.000000

24 Oct 12:02:29 ntpdate[26399]: no server suitable &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;synchronization found
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see from the output above, we cannot communicate with any server. Contact your network administrator.&lt;/p&gt;

&lt;h3 id=&quot;ntpq-tool-command-shows-zeroes-in-output&quot;&gt;NTPQ tool command shows zeroes in output&lt;/h3&gt;

&lt;p&gt;If you use &lt;code class=&quot;highlighter-rouge&quot;&gt;ntpq&lt;/code&gt; tool and the output is the following:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bobos@WEBSRV01:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo date&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ntpq &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
Tue Nov 24 13:26:45 EEST 2017
     remote           refid      st t when poll reach   delay   offset  jitter
&lt;span class=&quot;o&quot;&gt;==============================================================================&lt;/span&gt;
 3.gr.pool.ntp.o .POOL.          16 p    -   64    0    0.000    0.000   0.000
 1.europe.pool.n .POOL.          16 p    -   64    0    0.000    0.000   0.000
 2.europe.pool.n .POOL.          16 p    -   64    0    0.000    0.000   0.000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then it means that you have no communication at all with your NTP servers.  Contact your network administrator. A valid and working output would be:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bobos@WEBSRV01:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ntpq &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
Tue Nov 24 11:00:34 EEST 2017
     remote           refid      st t when poll reach   delay   offset  jitter
&lt;span class=&quot;o&quot;&gt;==============================================================================&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; 3.gr.pool.ntp.o    .POOL.      4 u  988 1024  377    1.180   39.213  24.397
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; 1.europe.pool.n    .POOL.      4 u  986 1024  377    1.080   38.984  24.397
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; 2.europe.pool.n    .POOL.      4 u  985 1024  377    1.710   39.213  24.397
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;bibliography&quot;&gt;Bibliography&lt;/h2&gt;

&lt;p&gt;For a more “in depth dive” you can find more in the following links:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://help.ubuntu.com/lts/serverguide/NTP.html&quot;&gt;https://help.ubuntu.com/lts/serverguide/NTP.html&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://wiki.debian.org/NTP&quot;&gt;https://wiki.debian.org/NTP&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://askubuntu.com/questions/429306/ntpdate-no-server-suitable-for-synchronization-found&quot;&gt;https://askubuntu.com/questions/429306/ntpdate-no-server-suitable-for-synchronization-found&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://askubuntu.com/questions/825869/ntpd-does-not-sync-clock-while-ntpdate-does&quot;&gt;https://askubuntu.com/questions/825869/ntpd-does-not-sync-clock-while-ntpdate-does&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;That’s it! We hope it helped you! It was a long story to debug and actually narrate afterwards!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="linux" /><category term="ntp" /><category term="debian" /><category term="ubuntu" /><category term="server" /><category term="time" /><category term="sync" /><category term="synchronisation" /><category term="install" /><category term="configure" /><category term="error" /><category term="network" /><category term="ntpdate" /><category term="ntpq" /><category term="service" /><category term="strata" /><category term="high" /><category term="suitable" /><category term="minpoll" /><category term="maxpoll" /><category term="pool" /><category term="iburst" /><summary type="html">If you are reading this article, perhaps you have searched a lot about NTP server installation in Linux, issues and problems encountered and how to troubleshoot them! We know that there are so many articles about how to configure NTP servers but we could not find any which contains all the issues we faced in the same place!</summary></entry><entry><title type="html">MongoDB replica error RS102 too stale to catch up during full recovery</title><link href="https://manios.org/2017/11/23/mongodb-replica-stale-during-recovery" rel="alternate" type="text/html" title="MongoDB replica error RS102 too stale to catch up during full recovery" /><published>2017-11-23T10:09:00+02:00</published><updated>2017-11-23T10:09:00+02:00</updated><id>https://manios.org/2017/11/23/mongodb-replica-stale-during-recovery</id><content type="html" xml:base="https://manios.org/2017/11/23/mongodb-replica-stale-during-recovery">&lt;p&gt;We run MongoDB 2.6.0 on a production system configured with a replica set of 3 members:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Primary&lt;/li&gt;
  &lt;li&gt;Secondary&lt;/li&gt;
  &lt;li&gt;Arbiter&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;About 3 weeks ago we had to move the data files from a data centre to another due to disk size problems. Database size had reached 15.6TB. Thus we copied only the data from the &lt;code class=&quot;highlighter-rouge&quot;&gt;PRIMARY&lt;/code&gt; node to the new data centre and we started the &lt;code class=&quot;highlighter-rouge&quot;&gt;SECONDARY&lt;/code&gt; node totally empty in order to recover via full replication. You can read more about the procedure in this blog post: &lt;TODO Add=&quot;&quot; post=&quot;&quot;&gt;.&lt;/TODO&gt;&lt;/p&gt;

&lt;p&gt;Due to the large size of the database we had to check the recovery replication process daily. During the last 3 days the status of the replica was as usual &lt;code class=&quot;highlighter-rouge&quot;&gt;STARTUP2&lt;/code&gt; and the logs showed that it builds its indexes:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2017-11-20T08:53:55.491+0200 [rsSync] Index Build: 62017200/69819295 88%
2017-11-21T09:10:01.192+0200 [rsSync] Index Build: 66154400/69819295 94%
2017-11-22T08:33:52.992+0200 [rsSync] Index: (2/3) BTree Bottom Up Progress: 33284400/53472142 62%
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the meantime, Nagios monitoring showed an increase in the replication lag:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2017-11-20T08:53:55.491+0200 Replication lag: 586379 seconds (6.79 days)
2017-11-21T09:10:01.192+0200 Replication lag: 673901 seconds (7.8 days)
2017-11-22T08:33:52.992+0200 Nagios - Replication lag: 758020 seconds (8.77 days)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It made us quite skeptikal until today, when in the daily check, we stumbled upon an error! What a coincidence! Replication had stopped with the following error:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2017-11-23T08:54:25.937+0200 [rsBackgroundSync] replSet not trying to sync from 192.168.10.4:27017, it is vetoed for 8 more seconds
2017-11-23T08:54:25.937+0200 [rsBackgroundSync] replSet not trying to sync from 192.168.10.4:27017, it is vetoed for 8 more seconds
2017-11-23T08:54:30.000+0200 [rsBackgroundSync] replSet not trying to sync from 192.168.10.4:27017, it is vetoed for 3 more seconds
2017-11-23T08:54:30.000+0200 [rsBackgroundSync] replSet not trying to sync from 192.168.10.4:27017, it is vetoed for 3 more seconds
2017-11-23T08:54:34.062+0200 [rsBackgroundSync] replSet syncing to: 192.168.10.4:27017
2017-11-23T08:54:34.109+0200 [rsBackgroundSync] replSet error RS102 too stale to catch up, at least from 192.168.10.4:27017
2017-11-23T08:54:34.109+0200 [rsBackgroundSync] replSet our last optime : Nov 13 14:06:29 5a098ac5:6
2017-11-23T08:54:34.109+0200 [rsBackgroundSync] replSet oldest at 192.168.10.4:27017 : Nov 16 10:30:19 5a0d4c9b:6
2017-11-23T08:54:34.109+0200 [rsBackgroundSync] replSet See http://dochub.mongodb.org/core/resyncingaverystalereplicasetmember
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also when we run on the &lt;code class=&quot;highlighter-rouge&quot;&gt;PRIMARY&lt;/code&gt; the command &lt;code class=&quot;highlighter-rouge&quot;&gt;rs.status()&lt;/code&gt; it gave us the following output:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;set&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;panamapapers-rs&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;date&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ISODate(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2017-11-23T07:12:11.000Z&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;myState&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;members&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;192.168.10.4:27017&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;health&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;state&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;stateStr&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;PRIMARY&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;uptime&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1380243&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;optime&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Timestamp(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1511421121&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;optimeDate&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ISODate(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2017-11-23T07:12:01.000Z&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;electionTime&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Timestamp(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1510041044&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;electionDate&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ISODate(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2017-11-07T07:50:44.000Z&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;self&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;192.168.10.5:27017&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;health&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;state&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;stateStr&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;RECOVERING&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;uptime&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;836950&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;optime&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Timestamp(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1510574789&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;optimeDate&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ISODate(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2017-11-13T12:06:29.000Z&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lastHeartbeat&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ISODate(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2017-11-23T07:12:11.000Z&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lastHeartbeatRecv&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ISODate(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2017-11-23T07:12:10.000Z&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;pingMs&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lastHeartbeatMessage&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;error RS102 too stale to catch up&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;192.168.10.9:27017&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;health&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;state&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;stateStr&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ARBITER&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;uptime&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1380095&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lastHeartbeat&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ISODate(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2017-11-23T07:12:10.000Z&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lastHeartbeatRecv&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ISODate(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2017-11-23T07:12:10.000Z&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;pingMs&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ok&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After searching in the internet we found issue &lt;a href=&quot;https://jira.mongodb.org/browse/SERVER-14523&quot;&gt;SERVER-14523&lt;/a&gt; where a guy had the same problem as ours. Furthermore we read again the official documentation of how to &lt;a href=&quot;https://docs.mongodb.com/v2.6/tutorial/resync-replica-set-member/&quot;&gt;Resync a Member of a Replica Set&lt;/a&gt;. The solutions to our problem were the following:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.mongodb.com/manual/core/replica-set-oplog/&quot;&gt;Resize the oplog&lt;/a&gt; to a large value and restart initial sync replication by deleting all files in the &lt;code class=&quot;highlighter-rouge&quot;&gt;SECONDARY&lt;/code&gt; node.&lt;/li&gt;
  &lt;li&gt;Copy all data files from the &lt;code class=&quot;highlighter-rouge&quot;&gt;PRIMARY&lt;/code&gt; to the &lt;code class=&quot;highlighter-rouge&quot;&gt;SECONDARY&lt;/code&gt; node and restart both of them.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;We rejected resizing the oplog because the database grows every day +9GB so the oplog had to become at least 81GB in order to contain the changes of the aforementioned last 9 days.&lt;/p&gt;

&lt;p&gt;That’s it! I hope it helped you!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="mongo" /><category term="mongodb" /><category term="database" /><category term="replication" /><category term="recovery" /><category term="secondary" /><category term="replica" /><category term="sync" /><category term="synchronisation" /><category term="linux" /><summary type="html">We run MongoDB 2.6.0 on a production system configured with a replica set of 3 members: Primary Secondary Arbiter</summary></entry><entry><title type="html">Use HAProxy and Docker to load balance requests to Solr and SolrCloud</title><link href="https://manios.org/2017/11/15/use-haproxy-and-docker-for-solr-load-balancing" rel="alternate" type="text/html" title="Use HAProxy and Docker to load balance requests to Solr and SolrCloud" /><published>2017-11-15T12:14:00+02:00</published><updated>2017-11-15T12:14:00+02:00</updated><id>https://manios.org/2017/11/15/use-haproxy-and-docker-for-solr-load-balancing</id><content type="html" xml:base="https://manios.org/2017/11/15/use-haproxy-and-docker-for-solr-load-balancing">&lt;p&gt;We use Solr 4.6 with SolrCloud configuration in a production system. You may say: “It is hight time you upgraded to the latest version, isn’t it?”. And you will be absolute right! But currently this is not the case because full reindexing costs! Our SolrCloud consists of one shard and five replicas as seen in the screenshot bellow:&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/images/2017-11-15-haproxy-docker-and-solr/2017-11-15-solrcloud.png&quot;&gt;&lt;img src=&quot;/images/2017-11-15-haproxy-docker-and-solr/2017-11-15-solrcloud.png&quot; alt=&quot;SolrCloud with one shard and five replicas&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;p&gt;The problem we were facing was that SolrJ library does balance the requests using round robin algorithm when using class &lt;a href=&quot;https://lucene.apache.org/solr/4_6_0/solr-solrj/org/apache/solr/client/solrj/impl/LBHttpSolrServer.html&quot;&gt;LBHttpSolrServer&lt;/a&gt;. Furthermore, when a request to a node fails for any reason (timeout, http 403, http 404, etc), it &lt;a href=&quot;http://grepcode.com/file/repo1.maven.org/maven2/org.apache.solr/solr-solrj/4.6.0/org/apache/solr/client/solrj/impl/LBHttpSolrServer.java?av=f#265&quot;&gt;puts the node to a zombie list&lt;/a&gt; for 60 seconds. This can become a burden when the SolrCloud has heavy loads and you will start to see in your application logs:&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Exception in thread &quot;main&quot; org.apache.solr.client.solrj.SolrServerException: No live SolrServers available to handle this request
	at org.apache.solr.client.solrj.impl.LBHttpSolrServer.request(LBHttpSolrServer.java:289)
	at org.apache.solr.client.solrj.impl.CloudSolrServer.request(CloudSolrServer.java:310)
	at org.apache.solr.client.solrj.request.AbstractUpdateRequest.process(AbstractUpdateRequest.java:117)
	at org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:116)
	at org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:102)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So we decided to put a HAProxy instance to load balance the query requests to the SolrCloud using &lt;code class=&quot;highlighter-rouge&quot;&gt;leastconn&lt;/code&gt; (least connections) algorithm. After a lot of search and using a combination of &lt;a href=&quot;http://cbonte.github.io/haproxy-dconv/1.7/configuration.html&quot;&gt;official documentation&lt;/a&gt; and articles (&lt;a href=&quot;http://davehall.com.au/blog/dave/2010/03/13/solr-replication-load-balancing-haproxy-and-drupal&quot;&gt;link1&lt;/a&gt;, &lt;a href=&quot;https://gist.github.com/feniix/1974460&quot;&gt;link2&lt;/a&gt;) and the official HAProxy &lt;a href=&quot;https://hub.docker.com/_/haproxy/&quot;&gt;Docker image&lt;/a&gt; we created a container using the following configuration:&lt;/p&gt;

&lt;div class=&quot;language-nginx highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;global&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;127&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.0.0.1&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;local0&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;notice&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;maxconn&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2000&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;#user haproxy
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;#group haproxy
&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;defaults&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;log&lt;/span&gt;     &lt;span class=&quot;s&quot;&gt;global&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;mode&lt;/span&gt;    &lt;span class=&quot;s&quot;&gt;http&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;option&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;httplog&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;option&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;dontlognull&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;retries&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;connect&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;5000&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;client&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;server&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt;

&lt;span class=&quot;s&quot;&gt;listen&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;solrcloud&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;bind&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;0.0.0.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8983&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;mode&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;http&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;stats&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;enable&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;stats&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;uri&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;/haproxy?stats&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;stats&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;realm&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Strictly&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Private&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;stats&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;auth&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;haproxyuser:haproxypassword&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;balance&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;leastconn&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;option&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;httpclose&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;option&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;forwardfor&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;option&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;httpchk&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;GET&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;/solr/paradise-papers/admin/ping?wt=json&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;search1&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;192.168.1.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8983&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;check&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8983&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;inter&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;20s&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;fastinter&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;2s&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;search2&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;192.168.1.2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8983&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;check&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8983&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;inter&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;20s&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;fastinter&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;2s&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;search3&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;192.168.1.3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8983&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;check&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8983&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;inter&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;20s&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;fastinter&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;2s&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;search4&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;192.168.1.4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8983&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;check&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8983&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;inter&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;20s&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;fastinter&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;2s&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;search5&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;192.168.1.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8983&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;check&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8983&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;inter&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;20s&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;fastinter&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;2s&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;notes-on-configuration&quot;&gt;Notes on configuration:&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Our HAProxy runs in &lt;code class=&quot;highlighter-rouge&quot;&gt;192.168.1.10&lt;/code&gt; and all the queries are handled by port &lt;code class=&quot;highlighter-rouge&quot;&gt;8983&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;We can see statistics about the distribution of requests using HAProxy statistics page which is accessible in &lt;a href=&quot;http://192.168.1.10:8983/haproxy?stats&quot;&gt;http://192.168.1.10:8983/haproxy?stats&lt;/a&gt;. See:
    &lt;div class=&quot;language-nginx highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;k&quot;&gt;stats&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;uri&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;/haproxy?stats&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;stats&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;realm&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Strictly&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Private&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;stats&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;auth&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;haproxyuser:haproxypassword&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;We check if every Solr node is alive by pinging it (see: &lt;code class=&quot;highlighter-rouge&quot;&gt;option httpchk GET /solr/paradise-papers/admin/ping?wt=json&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;Check interval is 20 seconds (see: &lt;code class=&quot;highlighter-rouge&quot;&gt;inter 20s&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Now our search queries are handled better and we have already noticed an increase in query performance, faster response times and no downtime! This is a sample output from HAProxy statistics page:&lt;/p&gt;

&lt;figure&gt;
    &lt;a href=&quot;/images/2017-11-15-haproxy-docker-and-solr/2017-11-15-haproxy-stats.png&quot;&gt;&lt;img src=&quot;/images/2017-11-15-haproxy-docker-and-solr/2017-11-15-haproxy-stats.png&quot; alt=&quot;HAProxy as a load balancer to Solr and SolrCloud with one shard and five replicas using leastconn algorithm&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;p&gt;We hope you find this article helpful!&lt;/p&gt;</content><author><name>cmanios</name></author><category term="haproxy" /><category term="solr" /><category term="solrcloud" /><category term="docker" /><category term="linux" /><category term="install" /><category term="load" /><category term="balancing" /><summary type="html">We use Solr 4.6 with SolrCloud configuration in a production system. You may say: “It is hight time you upgraded to the latest version, isn’t it?”. And you will be absolute right! But currently this is not the case because full reindexing costs! Our SolrCloud consists of one shard and five replicas as seen in the screenshot bellow:</summary></entry><entry><title type="html">SublimeText 3 Fix greek (and other languages) accented chars input</title><link href="https://manios.org/2017/10/17/sublime-3-fix-greek-accented-characters" rel="alternate" type="text/html" title="SublimeText 3 Fix greek (and other languages) accented chars input" /><published>2017-10-17T21:27:48+03:00</published><updated>2017-10-17T21:27:48+03:00</updated><id>https://manios.org/2017/10/17/sublime-3-fix-greek-accented-characters</id><content type="html" xml:base="https://manios.org/2017/10/17/sublime-3-fix-greek-accented-characters">&lt;p&gt;Yesterday I installed SublimeText 3 editor (build 3143) in my PC and the first thing I realised was that I could not type any Greek accented characters. Thus when I wanted to type:
ex&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Το γοργόν και χάριν έχει.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;, Sublime actually showed&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Το γοργ´ον και χ´αριν ´εχει
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At first place I thought that maybe was a bug of this new version (I used SublimeText 2 for quite a long time without any problems). I search for bugs and then after quite some time I found in this &lt;a href=&quot;https://stackoverflow.com/questions/27703981/cant-type-accented-characters-in-sublime-text-3-ubuntu-14-10&quot;&gt;StackOverflow article&lt;/a&gt; that many people had experienced the same problem.&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;missing&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;accented&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;characters&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;fix&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Linux&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Mint&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;18.1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Serena&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ά&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ό&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ί&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ϊ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ή&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;έ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ύ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ώ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ύ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ΰ&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;α&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ά&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ο&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ό&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ι&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ί&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;¨&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ι&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ϊ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;η&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ή&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ε&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;έ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;υ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ύ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;¨&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;υ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ϋ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ω&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ώ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Ά&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Ό&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Ί&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Ή&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Έ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Ύ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;Ώ&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Α&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ά&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ο&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ό&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ι&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ί&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Η&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ή&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ε&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Έ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Υ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ύ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;keys&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;´&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ω&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;insert&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;characters&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ώ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>cmanios</name></author><category term="sublimetext" /><category term="sublime" /><category term="text" /><category term="editor" /><category term="linux" /><category term="accented" /><category term="accent" /><category term="char" /><category term="character" /><category term="greek" /><category term="fix" /><summary type="html">Yesterday I installed SublimeText 3 editor (build 3143) in my PC and the first thing I realised was that I could not type any Greek accented characters. Thus when I wanted to type: ex Το γοργόν και χάριν έχει. , Sublime actually showed Το γοργ´ον και χ´αριν ´εχει</summary></entry></feed>