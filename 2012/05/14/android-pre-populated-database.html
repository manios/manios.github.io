<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.2.2 by Michael Rose
  Copyright 2017 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Android pre-populated Database - cmanios</title>
<meta name="description" content="Today I am going to show you how to create an android application which comes with a pre-populated database. The database file has to be stored in assets directory.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="cmanios">
<meta property="og:title" content="Android pre-populated Database">
<meta property="og:url" content="https://manios.org/2012/05/14/android-pre-populated-database">


  <meta property="og:description" content="Today I am going to show you how to create an android application which comes with a pre-populated database. The database file has to be stored in assets directory.">







  <meta property="article:published_time" content="2012-05-14T09:12:48+03:00">





  

  


<link rel="canonical" href="https://manios.org/2012/05/14/android-pre-populated-database">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Christos Manios",
      "url": "https://manios.org",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="cmanios Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">cmanios</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="https://manios.org/year-archive/" >Posts archive</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://manios.org/categories/" >Categories</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://manios.org/tags/" >Tags</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://manios.org/about/" >About</a>
            </li>
          
        </ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

   

    <!-- TODO add Google AdSense -->
    <div class="initial-content">

        



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Android pre-populated Database">
    <meta itemprop="description" content="Today I am going to show you how to create an android application which comes with a pre-populated database. The database file has to be stored in assets directory.">
    <meta itemprop="datePublished" content="May 14, 2012">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Android pre-populated Database
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Today I am going to show you how to create an android application which comes with a pre-populated database. The database file has to be stored in <strong>assets</strong> directory.</p>

<p>Every file that is stored in Assets directory is compressed. <strong>Prior to Android 2.3, any compressed asset file with an uncompressed size of over 1 MB cannot be read from the APK</strong>. The limit on the uncompressed size of compressed assets was removed in Android 2.3. So someday in the future, when you don’t have to worry about Android versions lower than 2.3, you can avoid this heartache. (source: <a href="http://ponystyle.com/blog/2010/03/26/dealing-with-asset-compression-in-android-apps/">Brian Hardy-Dealing with Asset Compression in Android Apps</a></p>

<p>So if you have a database file over 1 mb and you write an application that supports Android versions prior to 2.3 you have 2 options</p>

<ol>
  <li>Split your database file in chunks which are smaller than 1Mb.</li>
  <li>Ship your file with an extension from the following and it will not be compressed. (<strong>This will increase your .apk file size by the size of database file</strong>):
    <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">//extract from Package.cpp in the aapt source code, on which types of files are not compressed by default:</span>

 <span class="cm">/* these formats are already compressed, or don't compress well */</span>
 <span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">kNoCompressExt</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s">".jpg"</span><span class="p">,</span> <span class="s">".jpeg"</span><span class="p">,</span> <span class="s">".png"</span><span class="p">,</span> <span class="s">".gif"</span><span class="p">,</span>
     <span class="s">".wav"</span><span class="p">,</span> <span class="s">".mp2"</span><span class="p">,</span> <span class="s">".mp3"</span><span class="p">,</span> <span class="s">".ogg"</span><span class="p">,</span> <span class="s">".aac"</span><span class="p">,</span>
     <span class="s">".mpg"</span><span class="p">,</span> <span class="s">".mpeg"</span><span class="p">,</span> <span class="s">".mid"</span><span class="p">,</span> <span class="s">".midi"</span><span class="p">,</span> <span class="s">".smf"</span><span class="p">,</span> <span class="s">".jet"</span><span class="p">,</span>
     <span class="s">".rtttl"</span><span class="p">,</span> <span class="s">".imy"</span><span class="p">,</span> <span class="s">".xmf"</span><span class="p">,</span> <span class="s">".mp4"</span><span class="p">,</span> <span class="s">".m4a"</span><span class="p">,</span>
     <span class="s">".m4v"</span><span class="p">,</span> <span class="s">".3gp"</span><span class="p">,</span> <span class="s">".3gpp"</span><span class="p">,</span> <span class="s">".3g2"</span><span class="p">,</span> <span class="s">".3gpp2"</span><span class="p">,</span>
     <span class="s">".amr"</span><span class="p">,</span> <span class="s">".awb"</span><span class="p">,</span> <span class="s">".wma"</span><span class="p">,</span> <span class="s">".wmv"</span>
 <span class="p">};</span>
</code></pre></div>    </div>
    <p>Then create your pre-populated database file which has android_metadata table in it and insert a record. (Android creates automatically this table when you are creating your database in a traditional way in SQLiteOpenHelper onCreate() method.) :
```sql
– create table
CREATE TABLE android_metadata (locale TEXT );</p>
  </li>
</ol>

<p>– insert record
INSERT INTO android_metadata VALUES(‘en_US’);</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Then create your class which extends SQLiteOpenHelper like this:

```java
public class DatabaseHelper extends SQLiteOpenHelper {

private static final String TAG = "DatabaseHelper";
private static final int DATABASE_VERSION = 1;

// database file name.
private static final String DB_NAME = "mp.jet";

private final Context myContext;

private static SQLiteDatabase myWritableDb;

/**
 * Constructor takes and keeps a reference of the passed context in order to
 * access to the application assets and resources.
 * 
 * @param context
 *            the application context
 */
public DatabaseHelper(Context context) {

	super(context, DB_NAME, null, 1);
	this.myContext = context;
}

@Override
public void onCreate(SQLiteDatabase db) {
}

@Override
public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
}

/**
 * Returns a writable database instance in order not to open and close many
 * SQLiteDatabase objects simultaneously
 * 
 * @return a writable instance to SQLiteDatabase
 */
public SQLiteDatabase getMyWritableDatabase() {
	if (myWritableDb == null || (!myWritableDb.isOpen())) {
		myWritableDb = this.getWritableDatabase();
	}

	return myWritableDb;
}

@Override
public void close() {
	super.close();
	if (myWritableDb != null) {
		myWritableDb.close();
		myWritableDb = null;
	}
}

/**
 * Creates an empty database on the system and rewrites it with your own
 * database.
 * */
public void createDataBase() throws IOException {

	boolean dbExist = databaseExists();

	if (dbExist) {
		// do nothing , database already exists
	} else {

		/**
		 * By calling this method and empty database will be created into
		 * the default system path of your application so we are gonna be
		 * able to overwrite that database with our database.
		 */
		this.getReadableDatabase();

		// release all opened database objects
		// if you omit this line you will get a "no such table exception"
		// and
		// the application will crash ONLY in the first run.
		this.close();

		try {

			copyDataBase();
		} catch (IOException e) {

			throw new Error("Error copying database");

		}
	}

}

/**
 * Check if the database already exist to avoid re-copying the file each
 * time you open the application.
 * 
 * @return true if it exists, false if it doesn't
 */
private boolean databaseExists() {

	SQLiteDatabase checkDB = null;

	try {
		String myPath = getDatabasePath();
		checkDB = SQLiteDatabase.openDatabase(myPath, null,
				SQLiteDatabase.OPEN_READONLY);

	} catch (SQLiteException e) {
		// database does not exist yet.
	}

	if (checkDB != null) {
		checkDB.close();
	}

	return checkDB != null ? true : false;
}

/**
 * Copies your database from your local assets-folder to the just created
 * empty database in the system folder, from where it can be accessed and
 * handled. This is done by transferring bytestream.
 * */
private void copyDataBase() throws IOException {
	Log.d(TAG, "copyDatabase()");

	// Open your local db as the input stream
	InputStream myInput = myContext.getAssets().open(DB_NAME);

	// Path to the just created empty db
	String outFileName = getDatabasePath();

	// Open the empty db as the output stream
	OutputStream myOutput = new FileOutputStream(outFileName);

	// transfer bytes from the inputfile to the outputfile
	byte[] buffer = new byte[1024];
	int length;
	while ((length = myInput.read(buffer)) &gt; 0) {
		myOutput.write(buffer, 0, length);
	}

	SQLiteDatabase checkDB = null; // get a reference to the db.

	try {

		checkDB = SQLiteDatabase.openDatabase(getDatabasePath(), null,
				SQLiteDatabase.OPEN_READWRITE);

		// once the db has been copied, set the new version..
		checkDB.setVersion(DATABASE_VERSION);
		checkDB.close();
	} catch (SQLiteException e) {
		// database does?t exist yet.
	}

	// Close the streams
	myOutput.flush();
	myOutput.close();
	myInput.close();

}

/**
 * Get absolute path to database file. The Android's default system path of
 * your application database is /data/data/&amp;ltpackage
 * name&amp;gt/databases/&amp;ltdatabase name&amp;gt
 * 
 * @return path to database file
 */
private String getDatabasePath() {
	// The Android's default system path of your application database.
	// /data/data/&lt;package name&gt;/databases/&lt;databasename&gt;
	return myContext.getFilesDir().getParentFile().getAbsolutePath()
			+ "/databases/" + DB_NAME;
}
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#android" class="page__taxonomy-item" rel="tag">android</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#asset" class="page__taxonomy-item" rel="tag">asset</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#database" class="page__taxonomy-item" rel="tag">database</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#java" class="page__taxonomy-item" rel="tag">java</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#pre-populated" class="page__taxonomy-item" rel="tag">pre-populated</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#android" class="page__taxonomy-item" rel="tag">Android</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#databases" class="page__taxonomy-item" rel="tag">Databases</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2012-05-14T09:12:48+03:00">May 14, 2012</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Android+pre-populated+Database%20https%3A%2F%2Fmanios.org%2F2012%2F05%2F14%2Fandroid-pre-populated-database" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmanios.org%2F2012%2F05%2F14%2Fandroid-pre-populated-database" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https%3A%2F%2Fmanios.org%2F2012%2F05%2F14%2Fandroid-pre-populated-database" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fmanios.org%2F2012%2F05%2F14%2Fandroid-pre-populated-database" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2012/05/09/bluetooth-adapter-device-name-and-mac-address-in-android" class="pagination--pager" title="Bluetooth adapter device name and MAC address in Android
">Previous</a>
    
    
      <a href="/2012/05/15/check-network-connectivity-and-obtain-wifi-mac-address-in-android" class="pagination--pager" title="Launch Logcat programmatically in Android
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a Comment</h4>
      <section id="disqus_thread"></section>
    
</div>
    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/10/05/metricbeat-debug-frame-section-error" rel="permalink">Resolve “Could not find __debug_frame section in binary” when trying to Debug Metricbeat with Delve and Go 1.10.4
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Today we were trying to debug Metricbeat (on commit #cff3e40c) using Visual Studio Code v1.27.2 and Delve debugger but it failed with the error:

</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/08/18/logstash-geoip-json-logs-maxmint-geolite-docker" rel="permalink">Rsyslog - Parse Json and enrich IP with Geolocation using Maxmind GeoLite2 City and ISP
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Today we wanted to parse some json logs which we had in a file using Rsyslog and enrich  them with Geolocation information regarding the city and the ISP an ...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/08/14/logstash-geoip-json-logs-maxmint-geolite-docker" rel="permalink">Logstash - Enrich IP with Geolocation using Maxmind GeoLite2 City and ISP
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Today we wanted to parse some json logs which we had in a file using Logstash and enrich  them with Geolocation information regarding the city and the ISP an...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2018/07/23/create-a-beat-based-on-metricbeat-resolving-bugs" rel="permalink">Creating a Beat based on Metricbeat resolving Init and create metricset failures
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  4 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">I suspect that you are reading this post after having trouble creating a new Elastic Beat based on Metricbeat. Bud do not worry! We have you covered and solv...</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>
        
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <div align="center" style="margin: 1em 0;">
        <!-- manios-first -->
        <!-- WARNING! Do not forget data-ad-test="on" attribute on localhost! -->
        <ins class="adsbygoogle"
             style="display:block; border-bottom: initial;"
             data-ad-client="ca-pub-6651682831425197"
             data-ad-slot="2514320571"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        </div>     
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

    </div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="https://github.com/manios"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Christos Manios. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>







  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-96500199-2', 'auto');
  ga('set', 'anonymizeIp', false)
  ga('send', 'pageview');
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://manios.org/2012/05/14/android-pre-populated-database";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/2012/05/14/android-pre-populated-database"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://manios-org.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  </body>
</html>
